var app=app||{};(function(){window.console||function(){var a=["log","debug","info","warn","error","assert","dir","dirxml","group","groupEnd","time","timeEnd","count","trace","profile","profileEnd"];window.console={};for(var b=0;b<a.length;++b)window.console[a[b]]=function(){}}(),window.addEvent("domready",function(){window.docScroller=new Fx.Scroll(document.body)})})(),String.implement("stripScripts",function(a){var b="",c=this.replace(/<script[^>]*>([\s\S]*?)<\/script>/gi,function(a,c){return b+=";"+c+"\n",""});return a===!0?Browser.exec(b):typeOf(a)=="function"&&a(b,c),c}),Element.implement({mouseOver:function(a){var b=this.getCoordinates();return a.x>b.left&&a.x<b.right&&a.y<b.bottom&&a.y>b.top}}),function(){Object.append(app,{templates:{},render:function(a,b,c){var d=this.templates[a];if(!d)return"Template "+a+" is not defined";var e=null;typeOf(b)==="function"?(c=b,b=this):typeOf(b)==="element"&&(e=b,b=this);var f=d.call(this,b||this);return e?f.stripScripts(function(a,b){e.set("html",b),a&&Browser.exec(a),c&&c(a,b)}):c&&f.stripScripts(c),f},go:function(a){(new Request.JSON({url:a,noCache:!0,onSuccess:function(b){app.pages=app.pages||[],app.pages.push(app.page),app.page=Object.append({$url:a},b),history.pushState(null,app.title||"",a),app.route()}})).get()},back:function(){app.page=app.pages.pop(),app.route()}})}(),Object.append(app,{showDialog:function(a){if(Browser.ie6){window.location.href="/browser_not_to_be_supported.htm";return}this.hideDialog();var b="_dialog_"+a;this[b]||this.render(b,function(a,c){var d=(new Element("div")).set("html",c),e=this[b]=d.getFirst().inject(this.view);e.store("dialog_id",b),a&&Browser.exec(a)}.bind(this)),document.body.setStyle("overflow","hidden"),this[b].show(),this._currentDialog=this[b];var c=this[b].retrieve("onShow");"function"==typeof c&&c.apply(this,Array.prototype.slice.call(arguments,1))},hideDialog:function(){var a=this._currentDialog;a&&(a.hide(),document.body.setStyle("overflow","auto"),a.hasClass("destroy")&&(delete this[a.retrieve("dialog_id")],a.destroy()),delete this._currentDialog)},forceLogin:function(){return app.req.user?!0:(window.location.href="/login/?back="+app.page.$url.pathname,!1)},initFollowButtons:function(){if(app.view.retrieve("followbutton"))return;app.view.addEvent("click:relay(a.follow,a.unfollow)",function(a){app.forceLogin();var b=a.target;b.get("tag")!=="a"&&(b=b.getParent("a"));var c=b.get("data-id"),d=(new Button(b)).disable();return b.hasClass("unfollow")?(d.setTitle("Unfollowing..."),(new Request.JSON({url:"/boards/"+c+"/unfollow/",onSuccess:function(a){b.removeClass("unfollow").addClass("follow"),d.setTitle("\u5173\u6ce8").enable()}})).post()):(d.setTitle("\u5173\u6ce8\u4e2d..."),(new Request.JSON({url:"/boards/"+c+"/follow/",onSuccess:function(a){b.addClass("unfollow").removeClass("follow"),d.setTitle("\u53d6\u6d88\u5173\u6ce8").enable()}})).post()),!1}),app.view.store("followbutton",!0)},initFollowUserButtons:function(a){if(app.view.retrieve("followuserbutton"))return;app.view.addEvent("click:relay(a.followuser,a.unfollowuser)",function(b){app.forceLogin();var c=b.target;c.get("tag")!=="a"&&(c=c.getParent("a"));var d=c.get("data-id"),e=(new Button(c)).disable();return c.hasClass("unfollowuser")?(e.setTitle("Unfollowing..."),(new Request.JSON({url:"/"+d+"/unfollow/",onSuccess:function(b){c.removeClass("unfollowuser").removeClass("wbtn").addClass("followuser").addClass("rbtn"),e.setTitle("\u5173\u6ce8").enable(),a&&a(c)}})).post()):(e.setTitle("\u5173\u6ce8\u4e2d..."),(new Request.JSON({url:"/"+d+"/follow/",onSuccess:function(b){c.addClass("unfollowuser").removeClass("followuser").removeClass("rbtn").addClass("wbtn"),e.setTitle("\u53d6\u6d88\u5173\u6ce8").enable(),a&&a(c)}})).post()),!1}),app.view.store("followuserbutton",!0)},initLikeButtons:function(){if(app.view.retrieve("likebutton"))return;app.view.addEvent("click:relay(a.like,a.unlike)",function(a){app.forceLogin();var b=a.target;b.get("tag")!=="a"&&(b=b.getParent("a"));var c=b.get("data-id"),d=(new Button(b)).disable();return b.hasClass("unlike")?(d.setTitle("Unliking..."),(new Request.JSON({url:"/pins/"+c+"/unlike/",onSuccess:function(a){b.removeClass("unlike"),d.setTitle("\u559c\u6b22").enable()}})).post()):(d.setTitle("Liking..."),(new Request.JSON({url:"/pins/"+c+"/like/",onSuccess:function(a){b.addClass("unlike"),d.setTitle("\u53d6\u6d88\u559c\u6b22").enable()}})).post()),!1}),app.view.store("likebutton",!0)},initDelCommentButtons:function(){if(app.view.retrieve("delcommentbutton"))return;app.view.addEvent("click:relay(a.DeleteComment)",function(a){app.forceLogin();var b=a.target;b.get("tag")!=="a"&&(b=b.getParent("a"));var c=b.get("href");return(new Request.JSON({url:c,data:{_method:"DELETE"},onSuccess:function(a){if(a.err)return alert(a.msg);var c=b.getParent("div.comment");c&&c.tween("opacity",0).get("tween").chain(function(){c.destroy()})}})).post(),!1}),app.view.store("delcommentbutton",!0)},initAddCommentButtons:function(){if(app.view.retrieve("addcommentbutton"))return;app.view.addEvent("click:relay(a.comment)",function(a){app.forceLogin();var b=a.target;b.get("tag")!=="a"&&(b=b.getParent("a"));var c=b.getParent("div.pin"),d=c.getElement("div.write"),e=d.getElement("textarea");return new FancyInput(e),b.hasClass("disabled")?(d.hide(),app.waterfall.update(c),b.removeClass("disabled")):(d.show(),app.waterfall.update(c),docScroller.toElement(c,"y").chain(function(){try{e.focus()}catch(a){}e.highlight()}),b.addClass("disabled")),!1}),app.view.addEvent("click:relay(a.grid_comment_button)",function(a){var b=a.target;b.get("tag")!=="a"&&(b=b.getParent("a"));if(b.hasClass("disabled"))return!1;var c=b.getParent("div.pin"),d=c.getElement("div.write"),e=d.getElement("form"),f=e.getElement("textarea"),g=d.getPrevious("div.comments"),h=f.get("value").trim();return h==""||h=="\u6dfb\u52a0\u8bc4\u8bba..."?(f.highlight(),!1):(b.addClass("disabled"),(new Request.JSON({url:e.get("action"),data:{text:h},onSuccess:function(a){if(a.err)alert(a.msg);else{f.set("value","");var d=app.render("_comment_item_convo",a.comment),e=Elements.from(d).inject(g);g.isDisplayed()||g.show(),e.highlight("#EEE"),app.waterfall.update(c)}b.removeClass("disabled")},onFailure:function(){alert("\u7f51\u7edc\u9519\u8bef\uff0c\u8bf7\u7a0d\u5019\u518d\u8bd5"),b.removeClass("disabled")}})).post(),!1)}),app.view.store("addcommentbutton",!0)}});var Button=new Class({Implements:[Options,Class.Occlude],options:{},property:"Button",initialize:function(a,b){this.element=document.id(a);if(this.occlude())return this.occluded;this.setOptions(b),this.label=this.element.getElement("strong"),this.title=this.label.get("html"),this.action=this.options.click?this.options.click.bind(this):!1,delete this.options.click,this.attach()},setTitle:function(a){return a=a||this.title,~this.title.indexOf("<em>")&&!~a.indexOf("<em>")&&(a="<em></em>"+a),this.label.set("html",a),this},attach:function(){this.action&&this.element.addEvent("click",this.action),this._disabled=!1},detach:function(){this.action&&this.element.removeEvent("click",this.action),this._disabled=!0},disable:function(){if(this._disabled)return;return this.detach(),this.element.addClass("disabled"),this.options.disabledTitle&&this.setTitle(this.options.disabledTitle),this},enable:function(){if(this._disabled===!1)return;return this.attach(),this.element.removeClass("disabled"),this.options.disabledTitle&&this.setTitle(this.title),this},bind:function(a){var b=instanceOf(a,FancyInput)?a:a.retrieve("FancyInput");return b&&b.addEvents({feed:this.enable.bind(this),hunger:this.disable.bind(this)}),this}}),PointyTip=new Class({Implements:[Events,Options,Class.Occlude],options:{},property:"PointyTip",initialize:function(a,b){this.element=document.id(a);if(this.occlude())return this.occluded;this.setOptions(b),this.titleEl=this.element.getElement(".title"),this.title=this.titleEl?this.titleEl.get("html"):!1,this.contentEl=this.element.getElement(".content"),this.content=this.contentEl?this.contentEl.get("html"):!1,this.closeBtn=this.element.getElement(".close"),this.arrow=this.element.getElement(".arrow"),this.arrowMask=this.element.getElement(".arrow-mask"),this.attach()},reset:function(a){a.position&&this.element.setStyles(a.position);if(a.arrow){delete a.arrow.top,delete a.arrow.bottom;var b=Object.merge({left:"auto"},a.arrow);this.arrow.setStyles(b),b.right?b.right-=10:b.left-=10,this.arrowMask.setStyles(b)}this.element.show()},setTitle:function(a){return this.title=a,this},attach:function(){this.closeBtn&&(this.addEvent("close",function(){this.element.hide()}.bind(this)),this.closeBtn.addEvents({click:function(){this.fireEvent("close")}.bind(this)}))},close:function(){this.fireEvent("close")}});(function(){if(Modernizr.input.placeholder)return;this.Form||(this.Form={}),this.Form.Placeholder=new Class({Implements:Options,options:{color:"#A9A9A9",clearOnSubmit:!0},initialize:function(a,b){this.setOptions(b),this.element=document.id(a),this.placeholder=this.element.get("placeholder"),this.original_color=this.element.getStyle("color"),this.is_password=this.element.get("type")=="password"?!0:!1,this.activatePlaceholder(),this.element.addEvents({focus:function(){this.deactivatePlaceholder()}.bind(this),blur:function(){this.activatePlaceholder()}.bind(this)}),this.element.getParent("form")&&this.options.clearOnSubmit&&this.element.getParent("form").addEvent("submit",function(a){this.element.get("value")==this.placeholder&&this.element.set("value","")}.bind(this))},activatePlaceholder:function(){if(this.element.get("value")==""||this.element.get("value")==this.placeholder)this.is_password&&this.element.set("type","text"),this.element.setStyle("color",this.options.color),this.element.set("value",this.placeholder)},deactivatePlaceholder:function(){this.element.get("value")==this.placeholder&&(this.is_password&&this.element.set("type","password"),this.element.set("value",""),this.element.setStyle("color",this.original_color))}})})();var FancyInput=new Class({Binds:["_checker"],Implements:[Events,Options,Class.Occlude],options:{},property:"FancyInput",initialize:function(a,b){this.element=document.id(a);if(this.occlude())return this.occluded;this.setOptions(b),this.label=this.element.getNext("label"),this.placeholder=this.element.get("placeholder"),!this.label&&this.placeholder&&!Modernizr.input.placeholder&&new Form.Placeholder(this.element),Browser.ie&&this.label&&this.label.addEvent("click",function(){this.element.focus()}.bind(this)),this.attach()},attach:function(){this._timer=null,this.element.addEvents({keyup:this._checker,focus:function(){this._timer=this._checker.periodical(500),this.fireEvent("focus",this)}.bind(this),blur:function(){this._timer&&clearTimeout(this._timer),this.fireEvent("blur",this)}.bind(this)}),this._checker()},setValue:function(a){this.element.set("value",a),this._checker()},getValue:function(){return this.element.get("value")},_checker:function(){this.element.get("value")!=""?(this.label&&this.label.hide(),this.fireEvent("feed")):(this.label&&this.label.show(),this.fireEvent("hunger"))}}),PopupPicker=new Class({Implements:[Events,Options],Binds:["attach","show","bodyClicked"],options:{},initialize:function(a,b,c){this.setOptions(c),this.element=document.id(a),this.popup=document.id(b),this.attach(),this.popup.addEvent("click:relay(li)",function(a){var b=a.target;b.get("tag")!="li"&&(b=b.getParent()),this.fireEvent("pick",b),this.hide()}.bind(this))},attach:function(){this.element.addEvent("click",this.show)},detach:function(){this.element.removeEvent("click",this.show)},show:function(){this.detach(),this.popup.show(),document.body.addEvent("click",this.bodyClicked),this.fireEvent("show")},hide:function(){this.popup.hide(),document.body.removeEvent("click",this.bodyClicked),this.attach.delay(100),this.fireEvent("hide")},bodyClicked:function(a){this.popup.isDisplayed()&&!this.popup.mouseOver(a.page)&&this.hide()}}),CategoryPicker=new Class({Implements:[Class.Occlude,Events,Options],Binds:["select"],property:"CategoryPicker",options:{itemHeight:30,maxVisibleItems:8,setHeight:!1},initialize:function(a,b){this.element=document.id(a);if(this.occlude())return this.occluded;this.setOptions(b),this.init()},init:function(){var a=this.element;this._maxH=this.options.itemHeight*this.options.maxVisibleItems,this.curEl=a.getElement(".CurrentBoard"),this.popEl=a.getElement(".BoardList"),this.bodyEl=a.getElement(".BoardListBody"),this.listEl=this.bodyEl.getElement("ul"),this.popup=new PopupPicker(a,this.popEl,{onPick:this.select.bind(this)}),this.build()},build:function(){this._empty(),app.settings.categories.each(function(a){this._injectItem(a.id,a.name)},this)},_empty:function(){this._items=0,this.listEl.empty()},_injectItem:function(a,b){this._items+=1;var c=(new Element("li",{"class":"BoardCategory",data:a,html:"<span>"+b+"</span>"})).inject(this.listEl);if(this.options.setHeight){var d=this._items*this.options.itemHeight;this.bodyEl.setStyle("height",d>this._maxH?this._maxH:d)}return c},select:function(a){if(!a)return;if(typeOf(a)==="element")return this.curEl.store("data",a.get("data")).set("html",a.getElement("span").get("html")),this.fireEvent("select"),this;var b=this.listEl.getElements("li");for(var c=0,d=b.length;c<d;c++)if(b[c].get("data")==a)return this.select(b[c]);return this},hide:function(){this.popup.hide()},getSelected:function(){return this.curEl.retrieve("data")}}),BoardPicker=new Class({Extends:CategoryPicker,options:{setHeight:!0},init:function(){this.parent(),app.req.user.boards?this.build():(new Request.JSON({url:"/boards/",noCache:!0,onSuccess:function(a){a.err?this.curEl.set("html",a.msg):(app.req.user.boards=a.boards,this.build())}.bind(this),onFailure:function(){this.curEl.set("html","\u7f51\u7edc\u9519\u8bef\uff0c\u8bf7\u7a0d\u5019\u518d\u8bd5")}.bind(this)})).get()},add:function(a){app.req.user.boards.push(a);var b=this._injectItem(a.board_id,a.title);return this.select(b),this},build:function(){if(!app.req.user.boards)return;var a=app.req.user.boards;if(!a||a.length===0)return;this._empty(),a.each(function(a){this._injectItem(a.board_id,a.title)},this),this.select(this.listEl.getFirst("li"))}}),ImagePicker=new Class({Implements:[Events,Options,Class.Occlude],options:{cellW:170,minW:100,minH:100},property:"ImagePicker",initialize:function(a,b){this.element=document.id(a);if(this.occlude())return this.occluded;this.setOptions(b),this.listEl=this.element.getElement(".carousel-list"),this.arrowEl=this.element.getElement(".Arrows"),this.loadEl=this.element.getElement(".load"),this.attach()},attach:function(){var a=!0;this.listEl.get("tween").addEvents({start:function(){a=!1},complete:function(){a=!0}}),this.arrowEl.getElements("a.picker").addEvent("click",function(b){var c=this.listEl.getStyle("left").toInt(),d=this.listEl.getStyle("width").toInt();return b.target.hasClass("imagePickerNext")&&c>this.options.cellW-d?a&&this.listEl.tween("left",c,c-this.options.cellW):b.target.hasClass("imagePickerPrevious")&&c<0&&a&&this.listEl.tween("left",c,c+this.options.cellW),!1}.bind(this))},load:function(a,b,c,d){if(this.loading)return;typeOf(c)=="function"&&(d=c,c=!0),c=c===undefined?!0:!!c;if(a.length==0)return;this.loading=!0,this.loadEl.show(),this.fireEvent("startLoading");var e=new Asset.images(a,{onComplete:function(){this.loadEl.hide(),this.loading=!1,c&&(e=e.filter(function(a){return a.width===""||a.height===""||a.width.toInt()>=this.options.minW&&a.height.toInt()>=this.options.minH}.bind(this))),typeOf(d)=="function"&&d(e),this.build(e,b),this.fireEvent("finishLoading")}.bind(this)});return e},build:function(a,b){this.source=b,this.listEl.set("tween",{duration:"short"}).setStyles({width:a.length*this.options.cellW,left:0}).empty(),a.each(function(a){a.width<a.height?a.set("height",this.options.cellW).erase("width"):a.set("width",this.options.cellW).erase("height"),a.inject((new Element("li",{"class":"carousel-item"})).inject(this.listEl))},this),a.length>1?this.arrowEl.show():this.arrowEl.hide()},insertImageElement:function(a,b,c){c.width<c.height?c.set("height",this.options.cellW).erase("width"):c.set("width",this.options.cellW).erase("height"),c.inject((new Element("li",{"class":"carousel-item"})).inject(this.listEl))},assetComplate:function(){this.loadEl.hide(),this.loading=!1,this.fireEvent("finishLoading")},getSelected:function(){var a=0-this.listEl.getStyle("left").toInt()/this.options.cellW,b=this.listEl.getElements("li img")[a];return{el:b,src:b.src,link:this.source}}});app.createCellLoader=function(a,b,c){function e(a,b){var c;return b?c=app.render(b,{user:a,req:app.req}):a.pin_id?c=app.render("_pin_item",{user:a.user,pin:a,board:a.board}):a.board_id?c=app.render("_board_item",{board:a,user:app.req.user}):c=app.render("_user_item",{user:a}),(new Element("div")).set("html",c).getFirst()}var d=!1;return b=b||10,function(f){if(d)return;d=!0;var g=f.getLast();if(!g)return;var h=g.get("data-seq");f.showIndicator(),(new Request.JSON({url:a,noCache:!0,data:{max:h,limit:b},onSuccess:function(a){f.hideIndicator();if(a.err){alert(a.msg);return}var a=c?c(a):{data:a.pins};a.data.length==0?f.stopLoader(!0):a.data.each(function(b){f.append(e(b,a.tpl))})},onComplete:function(){d=!1}})).get()}};var Waterfall=new Class({Binds:["resize","scroll"],Implements:[Options,Events],options:{cellWidth:222,cellSpace:15,cellSelector:"div.wfc",sideSpace:0,preservedCols:0,containerSelector:"div.wrapper",loadOffset:100,loader:null},initialize:function(a,b){this.element=document.id(a),this.setOptions(b),this.cols=0,this.width=0,this.height=0,this.options.cellSelector?this.cells=this.element.getElements(this.options.cellSelector):this.cells=[],this._top=this.element.getCoordinates(document.body).top,this.attach(),this.options.loader&&(this._indicator=this._createIndicator())},_createIndicator:function(){return(new Element("div",{"class":"loading"})).inject(this.element,"after").hide().set("html",'<img src="/img/loading.gif"><span>\u6b63\u5728\u52a0\u8f7d...</span>')},showIndicator:function(){this._indicator&&this._indicator.show()},hideIndicator:function(){this._indicator&&this._indicator.hide()},attach:function(){window.addEvent("resize",this.resize),window.addEvent("scroll",this.scroll)},detach:function(){window.removeEvent("resize",this.resize),window.removeEvent("scroll",this.scroll)},resize:function(){return this.reposition()},scroll:function(){if(!this.options.loader||this._stopLoading)return;var a=window.getSize().y,b=window.getScroll().y,c=this._hs[this._minCol]+this._top;if(b+a<c-this.options.loadOffset)return;this.options.loader(this)},stopLoader:function(a){return this._stopLoading=!0,a&&this._indicator&&this._indicator.set("html",'<img src="/img/end.png">').show(),this},getLast:function(){return this.cells.getLast()},reposition:function(){if(this._needsLayout()){this._updateWidth();for(var a=0,b=this.cells.length;a<b;a++)this._position(this.cells[a]);this.fireEvent("layout",this)}return this},update:function(a){var b=a.retrieve("wf:col"),c=a.getHeight(),d=c-a.retrieve("wf:height"),e=this.cells,f=e.indexOf(a),g=[];for(var h=f+1,i=e.length;h<i;h++){var j=e[h];j.retrieve("wf:col")===b&&j.setStyle("top",j.getStyle("top").toInt()+d)}return this._hs[b]+=d,a.store("wf:height",c),this},append:function(a){return Browser.ie||a.fade("hide"),this.element.adopt(a),this.cells.include(a),this._position(a),Browser.ie||a.fade("in").get("tween").chain(function(){a.eliminate("tween")}),this},_updateWidth:function(){$$(this.options.containerSelector).setStyle("width",this.width)},_position:function(a){var b=this.cols-this.options.preservedCols,c=0,d=this._hs;if(a.hasClass("topright"))c=b-1;else for(var e=0;e<b;e++)d[e]<d[c]&&(c=e);a.setStyles({position:"absolute",left:c*(this.options.cellWidth+this.options.cellSpace),top:d[c]});var f=a.getHeight();a.store("wf:height",f).store("wf:col",c),d[c]+=f+this.options.cellSpace;var g=min=0;for(var e=0;e<b;e++)d[e]<d[min]&&(min=e),d[e]>d[g]&&(g=e);this._maxCol=g,this._minCol=min,this.element.setStyle("height",d[g]+50)},_needsLayout:function(){var a=this.options.cellWidth+this.options.cellSpace,b=Math.floor((document.body.getWidth()-this.options.sideSpace*2)/a);if(this.cols===b)return!1;var c=[];for(var d=0;d<b;d++)c.push(0);return this.width=b*a-this.options.cellSpace,this.cols=b,this._hs=c,!0}}),Uploadr=new Class({Implements:[Options,Events,Class.Occlude],options:{url:"/upload/",uploadText:"\u6b63\u5728\u4e0a\u4f20...",fieldName:"file"},property:"Uploadr",initialize:function(a,b){this.target=this.element=document.id(a);if(this.occlude())return this.occluded;this.setOptions(b),Browser.ie?(this.box=(new Element("div")).inject(this.target,"after"),this.target.hide()):(this.box=(new Element("div")).setStyles({position:"absolute",opacity:.01,overflow:"hidden"}).inject(this.target,"after"),this.btn=new Button(this.target,{disabledTitle:this.options.uploadText,click:function(){return this.file.click(),!1}.bind(this)})),this.create()},create:function(){this.clear(),this.iframe||(this.iframe=(new IFrame({src:"javascript:'<html></html>'",frameborder:"no",border:0})).inject(this.box),this.iframe.addEvents({load:this.onLoad.bind(this)})),Browser.ie?(this.iframe.setStyles({width:300,height:30}),this.runner=this.createIBody.periodical(50,this)):(this.iframe.setStyle("display","none"),this.createInput())},createIBody:function(){var a=this.iframe.contentWindow.document;if(!a||!a.body)return;clearTimeout(this.runner),a.body.innerHTML='<form method="post" enctype="multipart/form-data" id="form"><input type="file" id="file" style="position:absolute;left:0;top:0;" /><div id="data"></div></form><style type="text/css">body{background:#FCF9F9;}</style>',this.doc=a,this.processIBody.delay(50,this)},processIBody:function(){this.doc;if(!(this.file=this.doc.getElementById("file"))||!this.file.offsetHeight){this.createIBody();return}Object.append(this.file,{onmousedown:function(){return!1},onfocus:function(){return!1},onchange:this.select.bind(this)})},createInput:function(){var a=this.file=(new Element("input",{type:"file",name:this.options.fieldName,size:1,styles:{position:"absolute",top:0,left:0,border:0}})).inject(this.box);a.onfocus=function(){return!1},a.onchange=this.select.bind(this)},onLoad:function(){if(!this.iframe.parentNode)return;var a=this.iframe.contentWindow.document,b=a.body.innerHTML;if(this.loaded===!1)this.loaded=!0;else if(b!==""){this.loaded=!0;var c=b.match(/(\{.+\})/g);b=JSON.decode(c[0],!0),b.err?this.fireEvent("failed",[b]):this.fireEvent("complete",[b]),this.enable(),this.create()}},disable:function(){this.btn&&this.btn.disable(),this.disabled=!0},enable:function(){this.btn&&this.btn.enable(),this.disabled=!1},select:function(){this.disabled||this.disable(),this.file.onchange=this.file.onmousedown=this.file.onfocus=null;if(Browser.ie){var a=this.iframe.contentWindow.document;this.form=a.forms[0],this.file=this.form.elements[0]}else this.form=(new Element("form",{method:"post",enctype:"multipart/form-data",target:this.iframe.get("name"),styles:{width:0,height:0,overflow:"hidden"}})).adopt(this.file).inject(this.box);this.form.action=this.options.url,this.file.name=this.options.fieldName,this.fireEvent("start"),this.form.submit(),Browser.ie&&this.iframe.set("visibility","hidden")},reposition:function(){var a=this.target.getCoordinates(this.box.getOffsetParent());this.box.setStyles(a)},clear:function(){Browser.ie||this.form&&this.form.destroy(),this.form=null,this.file=null}}),StaticScroller=new Class({Implements:[Options,Events],options:{offset:20,scrollElement:document},initialize:function(a,b){this.setOptions(b),this.element=document.id(a),this.scrollElement=document.id(this.options.scrollElement),this.originalPosition=this.element.getPosition(),this.bound={scroll:this.scroll.bind(this),resize:this.resize.bind(this)},this.attachWindow(),this.checkHeight()},attachScroll:function(){return this.scrollElement.addEvent("scroll",this.bound.scroll),this},attachWindow:function(){return window.addEvent("resize",this.bound.resize),this},detachScroll:function(){return this.scrollElement.removeEvent("scroll",this.bound.scroll),this},detachWindow:function(){return window.removeEvent("resize",this.bound.resize),this},checkHeight:function(){return document.getSize().y<this.element.getSize().y?this.detachScroll().reset():this.attachScroll().scroll(),this},isPinned:function(){return this.element.retrieve("pin:_pinned")},scroll:function(){var a=this.scrollElement.getScroll().y>=this.originalPosition.y-this.options.offset,b=this.isPinned();return a?b||(this.element.pin().setStyle("top",this.options.offset.toInt()),this.fireEvent("pin")):b&&this.reset(),this},resize:function(){return this.isPinned()&&this.reset(),this.checkHeight(),this},reset:function(){this.isPinned()&&(this.element.unpin().setStyles({position:"",top:this.originalPosition.y}),this.fireEvent("unpin"))}});(function(){window.addEvent("domready",function(){app.view=app.view||$("page");var a=document.id("elevator");if(a){var b=new Fx.Scroll(window,{duration:"short"});new Button(a,{click:function(){b.toTop()}}),window.addEvent("scroll",function(b){window.getScrollTop()>200?a.removeClass("off"):a.addClass("off")})}(function(){$$(".ts-words").each(function(a){var b=a.retrieve("PinTime");if(!b){var c=a.get("data-ts");if(!c)return;b=new Date(c.toInt()*1e3),a.store("PinTime",b)}var d=new Date;if(d-b>2592e6)return;a.set("html",b.timeAgo())})}).periodical(6e4)})}).call(),function(){var a=window.navigator.userAgent.toLowerCase();Browser.anquan360=a.indexOf("360se")>-1,Browser.jisu360=a.indexOf("360ee")>-1,Browser.qq=a.indexOf("qqbrowser")>-1,Browser.sougou=a.indexOf("metasr")>-1,Browser.maxthon=a.indexOf("maxthon")>-1}()