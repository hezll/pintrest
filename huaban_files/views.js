(function(a){var b=a.templates,c=function(){return a.attrs.apply(a,arguments)},d=function(){return a._.apply(a,arguments)},e=function(){return a.img.apply(a,arguments)},f=function(){return a.imgURL.apply(a,arguments)},g=function(){return a.imgSize.apply(a,arguments)},h=function(){return a.avatar.apply(a,arguments)},i=function(){return a.escape.apply(a,arguments)},j=a.templates,k=function(){return a.render.apply(a,arguments)};j._board_item=function(a){var b=[];with (a || {}){var d;b.push("<div"),b.push(c({"data-id":""+board.board_id+"","data-seq":""+board.seq+"","class":"Board wfc"})),b.push(">"),user&&board.user_id==user.user_id&&(b.push("<div"),b.push(c({"class":"draglay"})),b.push("></div>")),b.push("<h3>"+i((d=board.title)==null?"":d)+"</h3>"),typeof h!="undefined"&&h.index_in_board&&(b.push("<span"),b.push(c({"class":"position"})),b.push(">"+i((d=h.index_in_board)==null?"":d)+"/"+i((d=board.pin_count)==null?"":d)+"</span>")),b.push("<a"),b.push(c({href:"/boards/"+board.board_id+"/","class":"link"})),b.push(">");for(var e=0,g=board.pins.length;e<g;e++){var h=board.pins[e];b.push("<img"),b.push(c({src:f(h.file,"sq75")})),b.push("/>")}b.push("</a>"),user&&(b.push("<div"),b.push(c({"class":"FollowBoard"})),b.push(">"),board.user_id!==user.user_id?board.following?(b.push("<a"),b.push(c({"data-id":""+board.board_id+"",href:"#",onclick:"return false;","class":"unfollow btn btn13 wbtn"})),b.push("><strong>\u53d6\u6d88\u5173\u6ce8</strong><span></span></a>")):(b.push("<a"),b.push(c({"data-id":""+board.board_id+"",href:"#",onclick:"return false;","class":"follow btn btn13 wbtn"})),b.push("><strong>\u5173\u6ce8</strong><span></span></a>")):(b.push("<a"),b.push(c({href:"/boards/"+board.board_id+"/edit/","class":"btn btn13 wbtn"})),b.push("><strong>\u7f16\u8f91</strong><span></span></a>")),b.push("</div>")),b.push("</div>")}return b.join("")},j._board_picker=function(a){var b=[];with (a || {}){var d;b.push("<div"),b.push(c({"class":"BoardListOverlay"})),b.push("></div><div"),b.push(c({"class":"BoardSelector BoardPicker"})),b.push("><div"),b.push(c({"class":"current"})),b.push("><span"),b.push(c({"class":"CurrentBoard"})),b.push(">\u9009\u62e9\u753b\u677f...</span><span"),b.push(c({"class":"DownArrow"})),b.push("></span></div><div"),b.push(c({"class":"BoardList"})),b.push("><div"),b.push(c({"class":"BoardListBody"})),b.push("><ul></ul></div><div"),b.push(c({"class":"CreateBoard"})),b.push("><input"),b.push(c({id:"board_name_input",type:"text",placeholder:"\u521b\u5efa\u65b0\u753b\u677f"})),b.push("/><a"),b.push(c({href:"#",onclick:"return false;","class":"nf btn btn18 wbtn"})),b.push("><strong> \u521b\u5efa</strong><span></span></a><div"),b.push(c({"class":"CreateBoardStatus"})),b.push('></div></div></div></div><script>(function(){$$("div.BoardPicker").each(function(a){if(a.retrieve("initialized"))return;var b=a.getElement("div.CreateBoard"),c=$("board_name_input"),d=b.getElement("a.btn"),e=b.getElement(".CreateBoardStatus"),f=$(document.body).getHeight()<400?5:8,g=new BoardPicker(a,{maxVisibleItems:f}),h=new FancyInput(c);(new Button(d,{click:function(){var a=c.get("value").trim();return a==""?(e.set("html","\u8bf7\u8f93\u5165\u540d\u79f0"),!1):(this.disable(),(new Request.JSON({url:"/boards/",data:{title:a},onSuccess:function(a){a.err?e.set("html",a.msg):g.add(a.board).hide()},onFailure:function(){e.set("html","\u7f51\u7edc\u9519\u8bef\uff0c\u8bf7\u7a0d\u5019\u518d\u8bd5")},onComplete:function(){h.setValue(""),this.enable()}.bind(this)})).post(),!1)}})).disable().bind(h),a.store("initialized",!0)})})()</script>')}return b.join("")},j._board_view=function(a){var b=[];with (a || {}){var d,e=k("_header");b.push(null==e?"":e);var f=page.board,g=f.user,j="/"+g.urlname,l="/boards/"+f.board_id;if(req.user&&!f.category_id){b.push("<div"),b.push(c({id:"category_callout"})),b.push("><div"),b.push(c({"class":"wrapper"})),b.push("><div"),b.push(c({"class":"callout"})),b.push("><div"),b.push(c({"class":"form"})),b.push("><p>\u4e3a\u8fd9\u4e2a\u753b\u677f\u6dfb\u52a0\u4e2a\u5206\u7c7b\uff0c\u8ba9\u5176\u4ed6\u4eba\u66f4\u5bb9\u6613\u627e\u5230\u5b83\u3002</p><div"),b.push(c({"class":"picker"})),b.push(">");var e=k("_category_picker");b.push(null==e?"":e),b.push("</div><div"),b.push(c({"class":"Submit"})),b.push("><a"),b.push(c({href:"#",onclick:"return false;","class":"btn btn18 rbtn"})),b.push("><strong> \u63d0\u4ea4</strong><span></span></a></div></div><div"),b.push(c({style:"display: none;","class":"success"})),b.push(">\u5df2\u6210\u529f\u8bbe\u7f6e\u5206\u7c7b\uff0c\u611f\u8c22\u4f60\u7684\u652f\u6301\u3002</div><div"),b.push(c({"class":"clear"})),b.push("></div></div></div></div>")}b.push("<div"),b.push(c({id:"nav_bar"})),b.push("><div"),b.push(c({id:"BoardTitle","class":"wrapper"})),b.push("><h1>"+i((d=f.title)==null?"":d)+"<span"),b.push(c({"class":"stats"})),b.push('>(<span class="count">'+i((d=f.pin_count)==null?"":d)+"</span> \u4e2a\u91c7\u96c6)</span></h1><div"),b.push(c({id:"BoardButton"})),b.push(">"),req.user&&f.user_id===req.user.user_id?(b.push("<a"),b.push(c({href:""+l+"/edit/","class":"btn btn13 wbtn"})),b.push("><strong>\u7f16\u8f91\u753b\u677f</strong><span></span></a>")):f.following?(b.push("<a"),b.push(c({"data-id":""+f.board_id+"",href:"#",onclick:"return false;","class":"unfollow btn wbtn"})),b.push("><strong>\u53d6\u6d88\u5173\u6ce8</strong><span></span></a>")):(b.push("<a"),b.push(c({"data-id":""+f.board_id+"",href:"#",onclick:"return false;","class":"follow btn wbtn"})),b.push("><strong>\u5173\u6ce8</strong><span></span></a>")),b.push("</div></div></div><div"),b.push(c({"class":"wrapper bl"})),b.push("><div"),b.push(c({id:"waterfall"})),b.push("><div"),b.push(c({id:"BoardMeta","class":"pin wfc topright"})),b.push("><h3"),b.push(c({"class":"nmt"})),b.push(">\u521b\u5efa\u8005</h3><div"),b.push(c({id:"BoardUser"})),b.push("><a"),b.push(c({href:"/"+i(g.urlname)+"/",title:i(g.username),"class":"img"})),b.push("><img"),b.push(c({src:h(g,undefined)})),b.push("/></a><span"),b.push(c({id:"BoardUserName"})),b.push("><a"),b.push(c({href:""+j+"/",title:""+g.username+""})),b.push(">"+i((d=g.username)==null?"":d)+"</a></span></div>");if(f.followers.length){b.push("<h3>\u5173\u6ce8\u8005</h3><div"),b.push(c({id:"BoardUsers"})),b.push(">");for(var m=0,n=f.followers.length;m<n;m++){var o=f.followers[m];b.push("<a"),b.push(c({href:"/"+i(o.urlname)+"/",title:i(o.username),"class":"img"})),b.push("><img"),b.push(c({src:h(o,undefined)})),b.push("/></a>")}b.push("</div>")}if(f.siblings.length){b.push("<div"),b.push(c({"class":"clear"})),b.push("></div><h3>\u5176\u5b83\u753b\u677f</h3><div"),b.push(c({id:"BoardBoards"})),b.push(">");for(var m=0,n=f.siblings.length;m<n;m++){var p=f.siblings[m];b.push("<a"),b.push(c({href:"/boards/"+p.board_id+"/"})),b.push(">"+i((d=p.title.brief(18))==null?"":d)+"<span"),b.push(c({"class":"stats"})),b.push(">"+i((d=p.pin_count)==null?"":d)+"</span></a>")}b.push("</div>")}b.push("</div>");for(var m=0,n=f.pins.length;m<n;m++){var q=f.pins[m],e=k("_pin_item",{user:g,pin:q,board:f});b.push(null==e?"":e)}b.push('</div></div><script>(function(){app.initFollowButtons(),app.initLikeButtons(),app.initAddCommentButtons(),window.addEvent("domready",function(){function f(){a.slide("out").get("slide").chain(function(){a.hide()})}var a=$("category_callout");if(!a||a.retrieve("initialized"))return;var b=a.getElement(".Submit a"),c=a.getElement(".form"),d=a.getElement(".success"),e=new CategoryPicker(a.getElement("div.CategoryPicker")),g=new Button(b,{click:function(){var a=e.getSelected();return a?(this.disable(),(new Request.JSON({url:"/boards/'+i((d=f.board_id)==null?"":d)+'/",data:{category:a},onSuccess:function(a){a.err?alert(a.msg):(c.hide(),d.show(),setTimeout(f,2e3))},onFailure:function(){alert("\u7f51\u7edc\u9519\u8bef\uff0c\u8bf7\u7a0d\u5019\u518d\u8bd5")},onComplete:function(){this.enable()}.bind(this)})).post(),!1):!1}});g.disable(),e.addEvent("select",function(){this.getSelected()?g.enable():g.disable()}),a.store("initialized",!0)})})()</script>')}return b.join("")},j._bookmarklet=function(a){var b=[];with (a || {}){var d;b.push("<div"),b.push(c({id:"bookmarklet",style:"width: 550px; height: 190px; margin: 40px auto;"})),b.push("><div"),b.push(c({"class":"form"})),b.push(">");var e=k("_dialog_pin_bottom",{text:page.params.text});b.push(null==e?"":e),b.push('</div></div><script>(function(){var a=270;Browser.ie&&(a+=90),Browser.firefox&&(a+=85),Browser.chrome&&(a+=58),Browser.safari&&(a+=80),window.resizeTo(632,a);var b=$("bookmarklet"),c=app.page.params.minWidth,d=app.page.params.minHeight;c=c<app.settings.minImageWidth?app.settings.minImageWidth:c,d=d<app.settings.minImageWidth?app.settings.minImageWidth:d;var e=b.getElement(".error"),f=b.getElements("img.load"),g=new ImagePicker(b.getElement(".ImagePicker"));g.setOptions({minW:c,minH:d});var h=app.page.params.media,i=function(a){return a.width===""||a.height===""||a.width.toInt()>=c&&a.height.toInt()>=d};if(!h||h.length<=0){var j=b.getElement("a.rbtn");f.show(),(new Request.JSON({url:"/pins/create/find_images/",data:{url:app.page.params.url},noCache:!0,onSuccess:function(a){if(a.err){e.set("html",a.msg);return}h=a.images.filter(i).map(function(a){return a.src}),h.length==0?e.set("html","\u62b1\u6b49\uff0c\u9875\u9762\u4e0a\u6ca1\u6709\u8db3\u591f\u5927\u7684\u56fe\u7247").show():g.load(h,app.page.params.url)},onComplete:function(a){(typeOf(h)!="array"||h.length==0)&&f.hide()},onFailure:function(){e.set("html","\u7f51\u7edc\u9519\u8bef\uff0c\u8bf7\u7a0d\u5019\u518d\u8bd5").show(),f.hide()}})).get()}else g.load(h,app.page.params.url)})()</script>')}return b.join("")},j._bookmarklet_success=function(a){var b=[];with (a || {}){var c,d=k("_pin_success",{pin:app.page.pin});b.push(null==d?"":d)}return b.join("")},j._categories_cell=function(a){var b=[];with (a || {}){var d,e=null,f=settings.categories;if(page.filter&&~page.filter.indexOf("category:")){var g=page.filter.split(":").pop();for(var h=0,j=f.length;h<j;h++)if(f[h].id===g){e=f[h];break}}b.push("<div"),b.push(c({"class":"pin category wfc"})),b.push("><a"),b.push(c({href:"/all/","class":e?"":"selected"})),b.push(">\u5168\u90e8</a>");for(var k=0,l=f.length;k<l;k++){var m=f[k];b.push("<a"),b.push(c({href:"/all/"+m.id+"/","class":e&&e.id===m.id?"selected":""})),b.push(">");var n=m.name;b.push(i(null==n?"":n)),b.push("</a>")}b.push("</div>")}return b.join("")},j._category_picker=function(a){var b=[];with (a || {}){var d;b.push("<div"),b.push(c({"class":"BoardListOverlay"})),b.push("></div><div"),b.push(c({"class":"BoardSelector BoardPicker CategoryPicker"})),b.push("><div"),b.push(c({"class":"current"})),b.push("><span"),b.push(c({"class":"CurrentBoard"})),b.push(">\u9009\u62e9\u5206\u7c7b</span><span"),b.push(c({"class":"DownArrow"})),b.push("></span></div><div"),b.push(c({"class":"BoardList"})),b.push("><div"),b.push(c({"class":"BoardListBody"})),b.push('><ul></ul></div></div></div><script>(function(){$$("div.CategoryPicker").each(function(a){if(a.retrieve("initialized"))return;new CategoryPicker(a),a.store("initialized",!0)})})()</script>')}return b.join("")},j._comment_form=function(a){var b=[];with (a || {}){var d;b.push("<div"),b.push(c({id:"PinAddComment","data-id":pin.pin_id,"class":"clearfix"})),b.push("><div"),b.push(c({id:"PinInputArea"})),b.push("><a"),b.push(c({href:"/"+i(user.urlname)+"/",title:i(user.username),"class":"img"})),b.push("><img"),b.push(c({src:h(user,undefined),"class":"avatar"})),b.push("/></a><div"),b.push(c({"class":"InputContainer Form FancyForm"})),b.push("><textarea"),b.push(c({id:"CloseupComment",name:"caption"})),b.push("></textarea><label>\u6dfb\u52a0\u8bc4\u8bba...</label><span"),b.push(c({"class":"fff"})),b.push("></span></div><div"),b.push(c({id:"PinAddCommentControls",style:"display:none;"})),b.push("><a"),b.push(c({id:"PostComment",href:"#",onclick:"return false;","class":"disabled btn btn13 wbtn"})),b.push('><strong> \u6dfb\u52a0\u8bc4\u8bba</strong><span></span></a></div></div></div><script>(function(a){var b=a("PinAddComment");if(b.retrieve("initialized"))return;var c=b.get("data-id"),d=a("PinAddCommentControls"),e=a("pin_comments"),f=new FancyInput("CloseupComment",{onFocus:function(){d.isDisplayed()||d.show()}});(new Button("PostComment",{click:function(){var a=f.getValue().trim();if(a=="")return alert("\u597d\u6b79\u8f93\u4e24\u4e2a\u5b57\u5427\uff0c\u4eb2!"),!1;var b=this;return(new Request.JSON({url:"/pins/"+c+"/comment/",data:{text:a},onSuccess:function(a){if(a.err)alert(a.msg);else{var c=app.render("_comment_item",a.comment),d=Elements.from(c).inject(e);d.highlight(),f.setValue("")}b.enable()},onFailure:function(){alert("\u7f51\u7edc\u9519\u8bef\uff0c\u8bf7\u7a0d\u5019\u518d\u8bd5"),b.enable()}})).post(),!1}})).disable().bind(f),b.store("initialized",!0)})(document.id)</script>')}return b.join("")},j._comment_item=function(a){var b=[];with (a || {}){var d;b.push("<div"),b.push(c({"class":"comment clearfix"})),b.push(">"),this.req.user&&user_id===this.req.user.user_id&&(b.push("<a"),b.push(c({href:"/pins/"+pin_id+"/comment/"+comment_id+"/","class":"DeleteComment fr"})),b.push("></a>")),b.push("<a"),b.push(c({href:"/"+i(user.urlname)+"/",title:i(user.username),"class":"img"})),b.push("><img"),b.push(c({src:h(user,undefined),"class":"avatar"})),b.push("/></a><p"),b.push(c({"class":"meta"})),b.push("><a"),b.push(c({href:"/"+user.urlname+"/","class":"author"})),b.push(">"+i((d=user.username)==null?"":d)+"</a>&nbsp;-&nbsp;<span"),b.push(c({"data-ts":""+created_at+"","class":"ts-words"})),b.push(">"+i((d=Date.timeAgo(created_at))==null?"":d)+"</span>\u8bf4\uff1a</p><p"),b.push(c({"class":"text"})),b.push(">"+i((d=raw_text.nl2br())==null?"":d)+"</p></div>")}return b.join("")},j._comment_item_convo=function(a){var b=[];with (a || {}){var d;b.push("<div"),b.push(c({"class":"comment convo clearfix"})),b.push("><a"),b.push(c({href:"/"+i(user.urlname)+"/",title:i(user.username),"class":"img"})),b.push("><img"),b.push(c({src:h(user,undefined)})),b.push("/></a><p><a"),b.push(c({herf:"/"+user.urlname+"/"})),b.push(">"+i((d=user.username)==null?"":d)+":&nbsp;</a>"+i((d=raw_text)==null?"":d)+"</p></div>")}return b.join("")},j._dialog_add=function(a){var b=[];with (a || {}){var c,d=k("_dialog_frame",{id:"Add",title:"\u91c7\u96c6",body:k("_dialog_add_body"),className:"PaddingLess"});b.push(null==d?"":d)}return b.join("")},j._dialog_add_body=function(a){var b=[];with (a || {}){var d;b.push("<p"),b.push(c({id:"PinIt"})),b.push(">\u4f7f\u7528\u4e66\u7b7e\u5c0f\u5de5\u5177\u5728\u6d4f\u89c8\u5176\u5b83\u7f51\u7ad9\u65f6\u76f4\u63a5\u91c7\u96c6\u4e0a\u9762\u7684\u56fe\u7247<a"),b.push(c({href:"/about/goodies/"})),b.push(">\u70b9\u51fb\u8fd9\u91cc</a>\u6dfb\u52a0\u4e66\u7b7e\u5de5\u5177</p><div"),b.push(c({id:"OpenLinks"})),b.push("><a"),b.push(c({id:"OpenScrapePin",onclick:"app.showDialog('scrape_pin');return false;","class":"cell"})),b.push("><div"),b.push(c({id:"scrape","class":"icon"})),b.push("></div><span>\u7f51\u5740\u91c7\u96c6</span></a><a"),b.push(c({id:"OpenUploadPin",onclick:"app.showDialog('upload_pin');return false;","class":"cell"})),b.push("><div"),b.push(c({id:"upload","class":"icon"})),b.push("></div><span>\u4e0a\u4f20\u91c7\u96c6</span></a><a"),b.push(c({id:"OpenCreateBoard",onclick:"app.showDialog('create_board');return false;","class":"cell"})),b.push("><div"),b.push(c({id:"board","class":"icon"})),b.push("></div><span>\u65b0\u5efa\u753b\u677f</span></a></div>")}return b.join("")},j._dialog_create_board=function(a){var b=[];with (a || {}){var c,d=k("_dialog_frame",{id:"CreateBoard",title:"\u521b\u5efa\u753b\u677f",body:k("_dialog_create_board_body"),destroyOnClose:!0});b.push(null==d?"":d)}return b.join("")},j._dialog_create_board_body=function(a){var b=[];with (a || {}){var d;b.push("<form"),b.push(c({action:"","class":"Form StaticForm nm"})),b.push("><ul><li"),b.push(c({"class":"nbt"})),b.push("><input"),b.push(c({id:"id_board_title",type:"text",name:"title",value:""})),b.push("/><label>\u753b\u677f\u6807\u9898</label><span"),b.push(c({"class":"fff"})),b.push("></span></li><li><input"),b.push(c({id:"id_category",type:"hidden",name:"category",value:""})),b.push("/>");var e=k("_category_picker");b.push(null==e?"":e),b.push("<label>\u753b\u677f\u5206\u7c7b</label></li></ul><div"),b.push(c({"class":"Submit"})),b.push("><a"),b.push(c({href:"#",onclick:"return false;","class":"btn btn18 wbtn"})),b.push("><strong>\u521b\u5efa\u753b\u677f</strong><span></span></a><div"),b.push(c({"class":"CreateBoardStatus msgr"})),b.push('></div></div></form><script>(function(){var a=$("CreateBoard");if(a.retrieve("initialized"))return;var b=$("id_board_title"),c=a.getElement(".CategoryPicker"),d=a.getElement("div.msgr"),e=new CategoryPicker(c);new Button(a.getElement(".Submit a"),{click:function(){var a=b.get("value").trim();if(a=="")return d.set("html","\u8bf7\u8f93\u5165\u540d\u79f0"),!1;var c=e.getSelected();return c?(this.disable(),(new Request.JSON({url:"/boards/",data:{title:a,category:c},onSuccess:function(a){a.err?d.set("html",a.msg):window.location="/boards/"+a.board.board_id+"/"},onFailure:function(){d.set("html","\u7f51\u7edc\u9519\u8bef\uff0c\u8bf7\u7a0d\u5019\u518d\u8bd5")},onComplete:function(){this.enable()}.bind(this)})).post(),!1):(d.set("html","\u8bf7\u9009\u62e9\u5206\u7c7b"),!1)}}),a.store("initialized",!0)})()</script>')}return b.join("")},j._dialog_frame=function(a){var b=[];with (a || {}){var d;b.push("<div"),b.push(c({id:""+id+"",style:"display:none;","class":"ModalContainer "+(typeof destroyOnClose=="undefined"?"":" destroy")})),b.push("><div"),b.push(c({"class":"modal wide "+(typeof className=="undefined"?"":" "+className)})),b.push("><div"),b.push(c({"class":"header lg"})),b.push("><a"),b.push(c({href:"#",onclick:"app.hideDialog(); return false","class":"close"})),b.push("><strong>Close</strong><span></span></a><h2>"+i((d=title)==null?"":d)+"</h2></div>");var e=body;b.push(null==e?"":e),b.push("</div><div"),b.push(c({"class":"overlay"})),b.push("></div></div>")}return b.join("")},j._dialog_mv=function(a){var b=[];with (a || {}){var d;b.push("<div"),b.push(c({id:"mv_holder",style:"display:none;","class":"ModalContainer"})),b.push("><div"),b.push(c({"class":"modal wide"})),b.push("><div"),b.push(c({"class":"header lg"})),b.push("><a"),b.push(c({href:"#",onclick:"app.hideDialog(); return false","class":"close"})),b.push("><strong>Close</strong><span></span></a><h2>\u4e86\u89e3\u82b1\u74e3</h2></div>"),navigator.userAgent.toLowerCase().match("ipad")?(b.push("<video"),b.push(c({id:"youku-html5-player-video",width:"450px",height:"300px","x-webkit-airplay":"allow",controls:"",autoplay:"",preload:"",src:"http://www.youku.com/player/getM3U8/vid/80315531/type/flv/v.m3u8"})),b.push("></video>")):(b.push("<embed"),b.push(c({src:"http://player.youku.com/player.php/sid/XMzIxMjYyMTI0/v.swf",allowFullScreen:"true",quality:"high",width:"480",height:"400",align:"middle",type:"application/x-shockwave-flash",flashvars:"winType=index"})),b.push("></embed>")),b.push("</div><div"),b.push(c({"class":"overlay"})),b.push("></div></div>")}return b.join("")},j._dialog_pin_bottom=function(a){var b=[];with (a || {}){var d;b.push("<div"),b.push(c({style:"display:none","class":"pbt"})),b.push("><div"),b.push(c({"class":"ImagePicker"})),b.push("><img"),b.push(c({src:"/img/load2.gif",alt:"Loading Indicator","class":"load"})),b.push("/><div"),b.push(c({"class":"Images pin carousel-container"})),b.push("><div"),b.push(c({"class":"carousel-clip"})),b.push("><ul"),b.push(c({"class":"carousel-list"})),b.push("><li><img"),b.push(c({src:"/img/DefaultPin.gif",alt:"Media"})),b.push("/></li></ul></div></div><div"),b.push(c({"class":"Arrows"})),b.push("><a"),b.push(c({href:"#","class":"imagePickerNext picker"})),b.push(">\u4e0b\u4e00\u5f20&nbsp;\u2192<span"),b.push(c({"class":"imagePickerNextArrow"})),b.push("></span></a><a"),b.push(c({href:"#","class":"imagePickerPrevious picker"})),b.push(">\u2190&nbsp;\u4e0a\u4e00\u5f20<span"),b.push(c({"class":"imagePickerPreviousArrow"})),b.push("></span></a></div></div><div"),b.push(c({"class":"pin-form"})),b.push(">");var e=k("_board_picker");b.push(null==e?"":e),b.push("<div"),b.push(c({"class":"InputArea"})),b.push("><ul"),b.push(c({"class":"Form FancyForm"})),b.push("><li"),b.push(c({"class":"nmb"})),b.push("><textarea"),b.push(c({rows:"2",name:"caption","class":"DescriptionTextarea"})),b.push(">"+i((d=typeof text!="undefined"?text:"")==null?"":d)+"</textarea><label>\u63cf\u8ff0\u4e00\u4e0b\u8fd9\u4e2a\u91c7\u96c6\u2026</label><span"),b.push(c({"class":"fff"})),b.push("></span></li></ul></div><div"),b.push(c({"class":"CreateBoardStatus error mainerror"})),b.push("></div><div"),b.push(c({"class":"Buttons"})),b.push("><a"),b.push(c({href:"#",onclick:"return false;","class":"btn btn18 rbtn"})),b.push("><strong> \u91c7\u4e0b\u6765</strong><span></span></a>"),this.req.user.bindings.weibo&&(b.push("<label"),b.push(c({"class":"weibo less"})),b.push("><input"),b.push(c({type:"checkbox",name:"pubish_to_weibo","class":"publish_to_weibo"})),b.push("/><span>\u5206\u4eab\u7ed9\u5fae\u535a\u7c89\u4e1d</span></label>")),b.push('</div></div></div><script>(function(){var a=app.page.params&&app.page.params.via||null;$$("div.pbt").each(function(b){if(b.retrieve("initialized"))return;var c=$("bookmarklet")!==null,d=b.getElement("textarea.DescriptionTextarea"),e=function(){var a=!1;return function(b,c){c=typeof c=="function"?c:function(){};if(a)return c();a=!0,setTimeout(function(){(new Request.JSON({url:"/feedback/pin",data:b,onSuccess:function(a){c()},onFailure:function(){a=!1,c()}})).post()},5e3)}}(),f=new ImagePicker(b.getElement(".ImagePicker"));new FancyInput(d);var g=b.getElement(".publish_to_weibo");g&&(g.addEvent("change",function(){var a=this.getParent("label");this.get("checked")?a.addClass("enabled"):a.removeClass("enabled")}),Cookie.read("share_to_weibo")=="true"&&(g.set("checked","checked"),g.fireEvent("change")));var h=(new Button(b.getElement("div.Buttons a.rbtn"),{click:function(){var g=d.get("value"),h=(new BoardPicker(b.getElement(".BoardPicker"))).getSelected(),i=f.getSelected();if(!i)return alert("\u6ca1\u6709\u9009\u62e9\u8981\u91c7\u96c6\u7684\u56fe\u7247");var j={board_id:h,text:g},k=i.el.retrieve("file"),l=i.el.retrieve("pin_id"),m=b.getElement(".publish_to_weibo"),n=b.getElement(".publish_to_douban");m&&m.get("checked")&&(j.weibo=!0),n&&n.get("checked")&&(j.douban=!0);var o={duration:30};m&&Cookie.write("share_to_weibo",j.weibo,o),n&&Cookie.write("share_to_douban",j.douban,o),j.via=c?2:1,a?j.via=a:j.via=c?2:1,l?j.via=l:k?j.file_id=k.id:(j.img_url=i.src,i.link&&(j.link=i.link));var p=this;return p.setTitle("\u91c7\u96c6\u4e2d...").disable(),(new Request.JSON({url:"/pins/",data:j,onSuccess:function(a){if(a.err){alert(a.msg),e(Object.merge(j,a),function(){p.setTitle().enable()});return}app.$pin=a.pin,c?app.route("/bookmarklet_success"):app.showDialog("pin_success")},onFailure:function(a){e(Object.merge(j,{err:a.status}),function(){p.setTitle().enable()})}})).post(),!1}})).disable();f.addEvents({startLoading:function(){h.disable()},finishLoading:function(){h.enable()}}),b.store("initialized",!0)})})()</script>')}return b.join("")},j._dialog_pin_success=function(a){var b=[];with (a || {}){var c,d=k("_dialog_frame",{id:"PinSuccess",title:"\u91c7\u96c6\u6210\u529f",destroyOnClose:!0,body:k("_pin_success")});b.push(null==d?"":d)}return b.join("")},j._dialog_repin=function(a){var b=[];with (a || {}){var c,d=k("_dialog_frame",{id:"Repin",title:"\u8f6c\u91c7",destroyOnClose:!0,body:k("_dialog_repin_body")});b.push(null==d?"":d)}return b.join("")},j._dialog_repin_body=function(a){var b=[];with (a || {}){var c,d=k("_dialog_pin_bottom");b.push(null==d?"":d),b.push('<script>(function(){var a=$("Repin");if(a.retrieve("onShow"))return;var b=a.getElements("img.load"),c=a.getElement(".pbt"),d=a.getElement("textarea.DescriptionTextarea"),e=new ImagePicker(a.getElement(".ImagePicker"));a.store("onShow",function(a){b.show(),c.show(),(new Request.JSON({url:"/pins/"+a+"/repin/",noCache:!0,onSuccess:function(c){c.err&&(app.hideDialog(),alert(c.msg)),b.hide(),e.load(app.imgURL(c.pin.file,"fw192"),null,!1,function(b){b&&b[0]&&b[0].store("pin_id",a)}),(new FancyInput(d)).setValue(c.pin.raw_text)}})).get()})})()</script>')}return b.join("")},j._dialog_scrape_pin=function(a){var b=[];with (a || {}){var c,d=k("_dialog_frame",{id:"ScrapePin",title:"\u7f51\u5740\u91c7\u96c6",destroyOnClose:!0,body:k("_dialog_scrape_pin_body")});b.push(null==d?"":d)}return b.join("")},j._dialog_scrape_pin_body=function(a){var b=[];with (a || {}){var d;b.push("<div"),b.push(c({"class":"PinTop inputHolder scrapePin"})),b.push("><ul"),b.push(c({"class":"Form FancyForm"})),b.push("><li><img"),b.push(c({src:"/img/load2.gif",alt:"Loading Indicator","class":"load"})),b.push("/><a"),b.push(c({id:"ScrapeButton",href:"#",onclick:"return false;","class":"fr btn btn18 wbtn"})),b.push("><strong> \u67e5\u627e\u56fe\u7247</strong><span></span></a><input"),b.push(c({id:"scrapePinInput",type:"text"})),b.push("/><label>http://</label><span"),b.push(c({"class":"fff"})),b.push("></span></li></ul></div>");var e=k("_dialog_pin_bottom");b.push(null==e?"":e),b.push('<script>(function(){var a=$("ScrapePin");if(a.retrieve("initialized"))return;var b=app.settings.minImageWidth,c=$("scrapePinInput"),d=a.getElement(".error"),e=a.getElements("img.load"),f=a.getElement(".pbt"),g=new ImagePicker(a.getElement(".ImagePicker"),{minW:b}),h=(new Button($("ScrapeButton"),{click:function(){var a=c.get("value").trim();if(a=="")return d.set("html","\u8bf7\u8f93\u5165URL"),!1;var f=this.disable();return e.show(),(new Request.JSON({url:"/pins/create/find_images/",data:{url:a},noCache:!0,onSuccess:function(c){if(c.err){d.set("html",c.msg),f.enable(),e.hide();return}var h=c.images.filter(function(a){return a.width==""||a.height==""||a.width.toInt()>=b||a.height.toInt()>=b}).map(function(a){return a.src});g.load(h,a)},onFailure:function(){d.set("html","\u7f51\u7edc\u9519\u8bef\uff0c\u8bf7\u7a0d\u5019\u518d\u8bd5"),f.enable(),e.hide()}})).get(),!1}})).disable().bind(new FancyInput(c));g.addEvents({startLoading:function(){h.disable(),f.show()},finishLoading:function(){h.enable(),e.hide(),f.show()}}),a.store("initialized",!0)})()</script>')}return b.join("")},j._dialog_upload_pin=function(a){var b=[];with (a || {}){var c,d=k("_dialog_frame",{id:"UploadPin",title:"\u4e0a\u4f20\u91c7\u96c6",destroyOnClose:!0,body:k("_dialog_upload_pin_body")});b.push(null==d?"":d)}return b.join("")},j._dialog_upload_pin_body=function(a){var b=[];with (a || {}){var d;b.push("<div"),b.push(c({"class":"PinTop"})),b.push("><a"),b.push(c({id:"upload_button",href:"#",onclick:"return false;","class":"btn btn18 wbtn"})),b.push('><strong> \u9009\u62e9\u56fe\u7247\u6587\u4ef6</strong><span></span></a></div><script>(function(){var a=$("UploadPin");if(a.retrieve("initialized"))return;var b=$("upload_button"),c=a.getElements("img.load"),d=a.getElement(".pbt"),e=new ImagePicker(a.getElement(".ImagePicker")),f=new Uploadr(b);f.addEvents({start:function(){c.show(),d.show()},failed:function(a){c.hide(),d.hide(),alert("\u4e0a\u4f20\u51fa\u9519: "+a.msg)},complete:function(a){c.hide(),e.load([app.imgURL(a,"fw192")],null,!1,function(b){b&&b[0]&&b[0].store("file",a)})}}),a.store("initialized",!0)})()</script>');var e=k("_dialog_pin_bottom");b.push(null==e?"":e)}return b.join("")},j._feed_list=function(a){var b=[];with (a || {}){var d;b.push("<ol"),b.push(c({"class":"activity"})),b.push(">");for(var e=0,g=feeds.length;e<g;e++){var h=feeds[e],i=user||h.user,j=h.content.type,k=h.pin,l=h.board,m=h.follow_user,n=this.req.user?this.req.user.user_id:-1,o='<a href="/'+i.urlname+'/">'+(n===i.user_id?"\u4f60":i.username)+"</a>";if(j=="pin"){b.push("<li><a"),b.push(c({href:"/pins/"+k.pin_id+"/","class":"img"})),b.push("><img"),b.push(c({src:f(k.file,"sq75")})),b.push("/></a>");var p=o;b.push(null==p?"":p),b.push("&nbsp;\u91c7\u96c6&nbsp;<a"),b.push(c({href:"/pins/"+k.pin_id+"/"})),b.push(">");var p=k.raw_text.brief(20);b.push(null==p?"":p),b.push("</a>&nbsp;\u5230&nbsp;<a"),b.push(c({href:"/boards/"+k.board_id+"/"})),b.push(">");var p=k.board.title.brief(18);b.push(null==p?"":p),b.push("</a></li>")}else if(j=="repin"){var q=k.via_user,r='<a href="/'+q.urlname+'/">'+(n===q.user_id?"\u4f60":q.username)+"</a>";b.push("<li><a"),b.push(c({href:"/pins/"+k.pin_id+"/","class":"img"})),b.push("><img"),b.push(c({src:f(k.file,"sq75")})),b.push("/></a>");var p=o;b.push(null==p?"":p),b.push("&nbsp;\u901a\u8fc7&nbsp;");var p=r;b.push(null==p?"":p),b.push("&nbsp;\u8f6c\u91c7\u4e86&nbsp;<a"),b.push(c({href:"/pins/"+k.pin_id+"/"})),b.push(">");var p=k.raw_text.brief(20);b.push(null==p?"":p),b.push("</a>&nbsp;\u5230&nbsp;<a"),b.push(c({href:"/boards/"+k.board_id+"/"})),b.push(">");var p=k.board.title.brief(18);b.push(null==p?"":p),b.push("</a></li>")}else if(j=="like"){b.push("<li><a"),b.push(c({href:"/pins/"+k.pin_id+"/","class":"img"})),b.push("><img"),b.push(c({src:f(k.file,"sq75")})),b.push("/></a>");var p=o;b.push(null==p?"":p),b.push("&nbsp;\u559c\u6b22\u7531&nbsp;<a"),b.push(c({href:"/"+k.user.urlname+"/"})),b.push(">");var p=n===k.user.user_id?"\u4f60":k.user.username;b.push(null==p?"":p),b.push("</a>&nbsp;\u91c7\u96c6\u7684&nbsp;<a"),b.push(c({href:"/pins/"+k.pin_id+"/"})),b.push(">");var p=k.raw_text.brief(20);b.push(null==p?"":p),b.push("</a></li>")}else if(j=="comment"){b.push("<li><a"),b.push(c({href:"/pins/"+k.pin_id+"/","class":"img"})),b.push("><img"),b.push(c({src:f(k.file,"sq75")})),b.push("/></a>");var p=o;b.push(null==p?"":p),b.push("&nbsp;\u8bc4\u8bba\u4e86\u7531&nbsp;<a"),b.push(c({href:"/"+k.user.urlname+"/"})),b.push(">");var p=n===k.user.user_id?"\u4f60":k.user.username;b.push(null==p?"":p),b.push("</a>&nbsp;\u91c7\u96c6\u7684&nbsp;<a"),b.push(c({href:"/pins/"+k.pin_id+"/"})),b.push(">");var p=k.raw_text.brief(20);b.push(null==p?"":p),b.push("</a></li>")}else if(j=="follow"){b.push("<li>");var p=o;b.push(null==p?"":p),b.push("&nbsp;\u5173\u6ce8\u4e86&nbsp;<a"),b.push(c({href:"/"+l.user.urlname+"/"})),b.push(">");var p=n===l.user.user_id?"\u4f60":l.user.username;b.push(null==p?"":p),b.push("</a>&nbsp;\u7684\u753b\u677f&nbsp;<a"),b.push(c({href:"/boards/"+l.board_id+"/"})),b.push(">");var p=l.title.brief(18);b.push(null==p?"":p),b.push("</a></li>")}else if(j=="follow_people"){b.push("<li>");var p=o;b.push(null==p?"":p),b.push("&nbsp;\u5173\u6ce8\u4e86&nbsp;<a"),b.push(c({href:"/"+m.urlname+"/"})),b.push(">");var p=n===m.user_id?"\u4f60":m.username;b.push(null==p?"":p),b.push("</a></li>")}}b.push("</ol>")}return b.join("")},j._header=function(a){var b=[];with (a || {}){var e;b.push("<div"),b.push(c({id:"header"})),b.push("><div"),b.push(c({"class":"wrapper"})),b.push("><a"),b.push(c({id:"huaban",href:"/"})),b.push("><img"),b.push(c({src:"/img/logo.png",width:"110",height:"43",alt:"\u82b1\u74e3"})),b.push("/></a><div"),b.push(c({id:"menu_bar"})),b.push("><ul"),b.push(c({id:"menu","class":"menu"})),b.push(">"),req.user&&(b.push("<li><a"),b.push(c({href:"#",onclick:"app.showDialog('add');return false;","class":"nav"})),b.push(">\u6dfb\u52a0<span"),b.push(c({"class":"plus-icon"})),b.push("></span></a></li>")),b.push("<li><a"),b.push(c({href:"/about/","class":"nav"})),b.push(">\u5173\u4e8e<span></span></a><ul><li><a"),b.push(c({href:"/about/"})),b.push(">\u5173\u4e8e\u82b1\u74e3</a></li><li><a"),b.push(c({href:"/about/goodies/"})),b.push(">\u91c7\u96c6\u5de5\u5177</a></li><li><a"),b.push(c({href:"/about/help/"})),b.push(">\u5e2e\u52a9</a></li><li><a"),b.push(c({href:"/pins/53553/"})),b.push(">\u7528\u6237\u53cd\u9988</a></li></ul></li>");if(req.user){var f="/"+req.user.urlname;b.push("<li"),b.push(c({id:"user_nav"})),b.push("><a"),b.push(c({href:""+f+"/","class":"nav"})),b.push("><img"),b.push(c({src:h(req.user,undefined)})),b.push("/>"+i((e=req.user.username)==null?"":e)+"<span></span></a><ul><li><a"),b.push(c({href:""+f+"/"})),b.push(">\u753b\u677f</a></li><li><a"),b.push(c({href:""+f+"/pins/"})),b.push(">\u91c7\u96c6</a></li><li><a"),b.push(c({href:""+f+"/likes/"})),b.push(">\u559c\u6b22</a></li><li"),b.push(c({"class":"divider"})),b.push("><a"),b.push(c({href:"/invites/"})),b.push(">\u9080\u8bf7\u670b\u53cb</a></li><li><a"),b.push(c({href:"/friends/weibo/"})),b.push(">\u67e5\u627e\u597d\u53cb</a></li><li"),b.push(c({"class":"divider"})),b.push("><a"),b.push(c({href:"/settings/"})),b.push(">\u5e10\u53f7\u8bbe\u7f6e</a></li><li><a"),b.push(c({href:"/logout/"})),b.push(">\u9000\u51fa\u767b\u5f55</a></li></ul></li>")}else b.push("<li><a"),b.push(c({href:"/login/","class":"nav"})),b.push(">\u767b\u5f55</a></li>");b.push("</ul><div"),b.push(c({id:"search"})),b.push("><form"),b.push(c({id:"search_form",method:"get",action:page.query?page.$url.pathname:"/search/","class":"text"})),b.push("><input"),b.push(c({id:"query",type:"text",size:"27",name:"q",autocomplete:"off",placeholder:"\u641c\u7d22",value:page.query?d(page.query.text):"","class":"default_value"})),b.push("/><a"),b.push(c({id:"search_lens",href:"#",onclick:"$('search_form').submit();return false;","class":"lg"})),b.push("><img"),b.push(c({src:"/img/search.gif",alt:"\u641c\u7d22"})),b.push("/></a></form></div></div></div></div>");if(!req.user){var g=k("_unauth_callout");b.push(null==g?"":g)}if(page.show_categories_bar){var g=k("_nav_bar");b.push(null==g?"":g)}}return b.join("")},j._index=function(a){var b=[];with (a || {}){var d,e=k("_header");b.push(null==e?"":e),b.push("<div"),b.push(c({"class":"wrapper"})),b.push(">");var f=~page.filter.indexOf("site:")?page.filter.substr(9):null;f&&(b.push("<div"),b.push(c({id:"ctx_bar","class":"board"})),b.push("><p>\u6765\u81ea<a"),b.push(c({href:"http://"+f+"",target:"_blank"})),b.push(">"+i((d=f)==null?"":d)+"</a>\u7684\u91c7\u96c6</p></div>")),b.push("<div"),b.push(c({id:"waterfall"})),b.push(">");if(!page.boards&&~page.filter.indexOf(":category")){var e=k("_categories_cell");b.push(null==e?"":e)}if(page.feeds&&page.feeds.length){b.push("<div"),b.push(c({id:"user_feeds","class":"pin wfc"})),b.push("><h3"),b.push(c({"class":"nmt"})),b.push(">\u6700\u65b0\u52a8\u6001</h3>");var e=k("_feed_list",{feeds:page.feeds,user:null});b.push(null==e?"":e),b.push("</div>")}if(page.pins)for(var g=0,h=page.pins.length;g<h;g++){var j=page.pins[g],e=k("_pin_item",{user:j.user,pin:j,board:j.board});b.push(null==e?"":e)}else for(var g=0,h=page.boards.length;g<h;g++){var l=page.boards[g],e=k("_board_item",{board:l,user:req.user});b.push(null==e?"":e)}b.push("</div></div><script>(function(){app.initLikeButtons(),app.initAddCommentButtons(),app.initFollowButtons()})()</script>")}return b.join("")},j._nav_bar=function(a){var b=[];with (a || {}){var d;b.push("<div"),b.push(c({id:"nav_bar"})),b.push("><div"),b.push(c({"class":"wrapper"})),b.push("><ul"),b.push(c({id:"nav","class":"menu"})),b.push(">");var e=~page.filter.indexOf("pin:")?"pin":"board",f=req.user&&~page.filter.indexOf(":following")?"following":~page.filter.indexOf(":popular")?"popular":"all",g=[["following","\u4f60\u5173\u6ce8\u7684"],["popular","\u70ed\u95e8"],["all","\u6700\u8fd1"]];req.user||g.shift(),e=="board"&&g.pop();var h=e=="pin"?"\u91c7\u96c6":"\u753b\u677f",j=e=="pin"?"":"boards/",l="";for(var m=0,n=g.length;m<n;m++){var o=g[m],p="nav";f==o[0]&&(p+=" selected",l=o[1]),b.push("<li><a"),b.push(c({href:"/"+j+""+o[0]+"/","class":p})),b.push(">");var q=o[1]+h;b.push(null==q?"":q),b.push("</a></li>")}b.push("<li"),b.push(c({"class":"nav-view"})),b.push("><a"),b.push(c({href:"/"+f+"/",title:l+"\u91c7\u96c6","class":"pin-view"+(e=="pin"?"-selected":"")})),b.push("></a>"),f=="all"&&(f="popular"),b.push("<a"),b.push(c({href:"/boards/"+f+"/",title:l+"\u753b\u677f","class":"board-view"+(e=="board"?"-selected":"")})),b.push("></a></li>"),req.user&&req.user.status.invites&&(b.push("<li><a"),b.push(c({id:"invite_friends",href:"/invites/","class":"btn rbtn"})),b.push("><strong> \u9080\u8bf7\u670b\u53cb\uff3b"+i((d=req.user.status.invites)==null?"":d)+"\uff3d</strong><span></span></a></li>"));if(req.user&&req.user.status.invite_new){var r="";req.user.bindings.weibo&&(r='<textarea name="tip_weibo_text" id="tip_weibo_text" style="width:400px;" rows="3">\u54e6\u54df\uff0c\u62ff\u5230\u51e0\u4e2a @\u82b1\u74e3\u7f51 \u7684\u9080\u8bf7\u7801\uff0c\u4e00\u952e\u91c7\u96c6\u4f60\u611f\u5174\u8da3\u7684\u56fe\u7247\uff0c\u518d\u4e00\u952e\u5206\u4eab\u7ed9\u597d\u53cb\uff0c\u771f\u5fc3\u597d\u7528\u6709\u6728\u6709\uff1f\u88ab\u8bf1\u60d1\u5230\u4e86\u6709\u6728\u6709\uff1f\u60f3\u8981\u5c1d\u9c9c\u7684\uff03\u7559\u4e0b\u90ae\u7bb1\uff03\u9ebb\u5229\u513f\u6765\u53d6\uff01</textarea>',r+='<p style="margin-top:5px;"><a id="tip_weibo_btn" class="btn rbtn btn13"><strong>\u53d1\u9001\u5230\u6211\u7684\u5fae\u535a</strong><span></span></a></p>');var q=k("_pointy_tip",{id:"invites_tip",title:"\u4f60\u73b0\u5728\u53ef\u4ee5\u9080\u8bf7\u597d\u53cb\u5230\u82b1\u74e3\u7f51\u4e86",content:r,className:"right-pointy"});b.push(null==q?"":q)}b.push('</ul></div></div><script>(function(){var a=document.id("invites_tip");if(a){var a=new PointyTip("invites_tip",{});a.reset({position:{top:41,right:0},arrow:{right:120}}),a.addEvents({close:function(){(new Request.JSON({url:"/profile/status/update/",data:{type:"invite"},onSuccess:function(){}})).post()}});var b=document.id("tip_weibo_btn");b&&(b=new Button("tip_weibo_btn",{click:function(){var b=$("tip_weibo_text").get("value");if(b.trim()=="")return errorMsg("weibo_text","\u8bf7\u8f93\u5165\u5fae\u535a\u5185\u5bb9");var c=this.disable();(new Request.JSON({url:"/invites/update_weibo_status/",data:{text:b},onSuccess:function(){c.setTitle("\u53d1\u9001\u5b8c\u6210"),a.fireEvent("close")}})).post()}}))}})()</script>')}return b.join("")},j._people_boards=function(a){var b=[];with (a || {}){var c,d=k("_header");b.push(null==d?"":d);var d=k("_people_layout",{req:req,user:page.user,ctx:"boards",body_tpl:"_people_boards_body"});b.push(null==d?"":d)}return b.join("")},j._people_boards_body=function(a){var b=[];with (a || {}){var d;b.push("<div"),b.push(c({id:"waterfall"})),b.push("><ul"),b.push(c({"class":"sortable"})),b.push(">");for(var e=0,f=user.boards.length;e<f;e++){var g=user.boards[e];b.push("<li>");var h=k("_board_item",{board:g,user:this.req.user});b.push(null==h?"":h),b.push("</li>")}b.push("</ul></div>")}return b.join("")},j._people_layout=function(a){var b=[];with (a || {}){var d,e="/"+user.urlname;b.push("<div"),b.push(c({id:"wrapper","class":"wrapper bl"})),b.push("><div"),b.push(c({id:"ProfileSidebar"})),b.push("><h1>"+i((d=user.username)==null?"":d)+"</h1><p><a"),b.push(c({href:""+e+"/followers/"})),b.push("><span>"+i((d=user.follower_count)==null?"":d)+"</span>\u4e2a\u7c89\u4e1d</a>,&nbsp; <a"),b.push(c({href:""+e+"/following/"})),b.push(">\u5173\u6ce8<span>"+i((d=user.following_count)==null?"":d)+"</span></a>\u4eba</p><div"),b.push(c({id:"ProfileImage"})),b.push("><a"),b.push(c({href:"/"+i(user.urlname)+"/",title:i(user.username),"class":"img"})),b.push("><img"),b.push(c({src:h(user,"fw192")})),b.push("/></a>"),req.user&&user.user_id===req.user.user_id?(b.push("<a"),b.push(c({href:"/settings/","class":"btn btn13 wbtn"})),b.push("><strong> \u8d26\u53f7\u8bbe\u7f6e</strong><span></span></a>")):user.following?(b.push("<a"),b.push(c({"data-id":""+user.urlname+"",href:"#",onclick:"return false;","class":"unfollowuser btn wbtn"})),b.push("><strong> \u53d6\u6d88\u5173\u6ce8</strong><span></span></a>")):(b.push("<a"),b.push(c({"data-id":""+user.urlname+"",href:"#",onclick:"return false;","class":"followuser btn rbtn"})),b.push("><strong> \u5173\u6ce8</strong><span></span></a>")),b.push("</div><p"),b.push(c({"class":"muted"})),b.push(">"+i((d=user.profile.about)==null?"":d)+"</p><p"),b.push(c({"class":"less"})),b.push(">"+i((d=user.profile.location)==null?"":d)+"</p><ul"),b.push(c({id:"ProfileLinks"})),b.push(">"),user.profile.url&&(b.push("<li"),b.push(c({id:"ProfileLinksWebsite"})),b.push("><a"),b.push(c({href:""+user.profile.url+"",title:"\u8bbf\u95ee"+user.username+"\u7684\u4e2a\u4eba\u4e3b\u9875",target:"_blank","class":"btn wbtn"})),b.push("><strong><img"),b.push(c({src:"/img/ProfileIconWebsite.png",alt:"\u8bbf\u95ee\u4e2a\u4eba\u4e3b\u9875",style:"margin-top: 3px;"})),b.push("/></strong><span></span></a></li>"));if(user.bindings.weibo){var f=user.bindings.weibo.user_info;b.push("<li"),b.push(c({id:"ProfileLinksWeibo"})),b.push("><a"),b.push(c({href:"http://weibo.com/"+(f.urlname?f.urlname:f.id)+"",title:"\u8bbf\u95ee"+user.username+"\u7684\u5fae\u535a",target:"_blank","class":"btn wbtn"})),b.push("><strong><img"),b.push(c({src:"/img/ProfileIconWeibo.png",alt:"\u8bbf\u95ee\u5fae\u535a"})),b.push("/></strong><span></span></a></li>")}user.bindings.douban&&(b.push("<li"),b.push(c({id:"ProfileLinksDouban"})),b.push("><a"),b.push(c({href:"http://www.douban.com/people/"+user.bindings.douban.user_info.urlname+"/",title:"\u8bbf\u95ee"+user.username+"\u7684\u8c46\u74e3\u4e3b\u9875",target:"_blank","class":"btn wbtn"})),b.push("><strong><img"),b.push(c({src:"/img/ProfileIconDouban.png",alt:"\u8bbf\u95ee\u8c46\u74e3\u4e3b\u9875"})),b.push("/></strong><span></span></a></li>")),b.push("</ul>");if(user.feeds){var g=k("_feed_list",{feeds:user.feeds,user:user});b.push(null==g?"":g)}b.push("</div><div"),b.push(c({id:"ctx_bar"})),b.push("><p"),b.push(c({"class":"bar-links"})),b.push(">");var j=[],l=[[user.board_count,"boards","\u753b\u677f","/"],[user.pin_count,"pins","\u91c7\u96c6","/pins/"],[user.like_count,"likes","\u559c\u6b22","/likes/"]];for(var m=0,n=l.length;m<n;m++){var o=l[m];if(ctx==o[1]){b.push("<span"),b.push(c({"class":"selected"})),b.push(">");var g=o[0]+" "+o[2];b.push(null==g?"":g),b.push("</span>")}else{b.push("<a"),b.push(c({href:"/"+user.urlname+""+o[3]})),b.push(">");var g=o[0]+" "+o[2];b.push(null==g?"":g),b.push("</a>")}m!==l.length-1&&b.push("&nbsp;\u00b7&nbsp;")}b.push("</p>"),ctx=="boards"&&req.user&&req.user.user_id==user.user_id&&(b.push("<div"),b.push(c({id:"BoardButton"})),b.push("><a"),b.push(c({id:"boards_sort_cancel",style:"visibility:hidden;",href:"#",onclick:"return false;","class":"btn wbtn"})),b.push("><strong> \u53d6\u6d88</strong><span></span></a><a"),b.push(c({id:"boards_sort",href:"#",onclick:"return false;","class":"btn wbtn"})),b.push("><strong> \u753b\u677f\u6392\u5e8f</strong><span></span></a></div>")),b.push("</div>");var g=k(body_tpl,{user:user});b.push(null==g?"":g),b.push("<div"),b.push(c({"class":"clear"})),b.push('></div></div><script>(function(){app.initFollowButtons(),app.initFollowUserButtons(function(a){function b(a,b){b?(new Button(a.addClass("unfollow"))).setTitle("\u53d6\u6d88\u5173\u6ce8"):(new Button(a.removeClass("unfollow"))).setTitle("\u5173\u6ce8")}$$("a.follow,a.unfollow").each(function(c){b(c,a.hasClass("unfollowuser"))})}),app.initLikeButtons(),app.initAddCommentButtons();var a=document.id("boards_sort");if(a){var b=!1,c=$$(".sortable")[0],d,e,f,g=function(){b=!0,a.setTitle("\u4fdd\u5b58\u6392\u5e8f"),a.element.removeClass("wbtn").addClass("rbtn"),c.addClass("dragable"),d||(d=new Sortables(c,{clone:!0,onStart:function(a,b){a.setStyles({visibility:"hidden"}),b.setStyles({"z-index":999999})},onComplete:function(a){a.setStyles({visibility:"visible"})}})),f=d.serialize(0,function(a){return a.getElement("div.Board").get("data-id")}),e=document.id("boards_sort_cancel"),e.setStyle("visibility","visible").show(),e.addEvents({click:function(){i(),window.location.reload()}})},h=function(){var b=d.serialize(0,function(a){return a.getElement("div.Board").get("data-id")});f.join("-")!=b.join("-")?(a.disable(),(new Request.JSON({url:"/boards/sort/",data:{ids:b.join(",")},onSuccess:i})).post()):i()},i=function(){c.removeClass("dragable"),a.setTitle("\u753b\u677f\u6392\u5e8f"),a.element.removeClass("rbtn").addClass("wbtn"),a.enable(),b=!1,e.hide(),b=!1};a=new Button(a,{disabledTitle:"\u6b63\u5728\u4fdd\u5b58",click:function(){b?h():g()}})}})()</script>')}return b.join("")},j._people_likes=function(a){var b=[];with (a || {}){var c,d=k("_header");b.push(null==d?"":d);var d=k("_people_layout",{req:req,user:page.user,ctx:"likes",body_tpl:"_people_likes_body"});b.push(null==d?"":d)}return b.join("")},j._people_likes_body=function(a){var b=[];with (a || {}){var d;b.push("<div"),b.push(c({id:"waterfall"})),b.push(">");for(var e=user.likes,f=0,g=e.length;f<g;f++){var h=e[f],i=k("_pin_item",{user:h.user,pin:h,board:h.board});b.push(null==i?"":i)}b.push("</div>")}return b.join("")},j._people_pins=function(a){var b=[];with (a || {}){var c,d=k("_header");b.push(null==d?"":d);var d=k("_people_layout",{req:req,user:page.user,ctx:"pins",body_tpl:"_people_pins_body"});b.push(null==d?"":d)}return b.join("")},j._people_pins_body=function(a){var b=[];with (a || {}){var d;b.push("<div"),b.push(c({id:"waterfall"})),b.push(">");for(var e=0,f=user.pins.length;e<f;e++){var g=user.pins[e],h=k("_pin_item",{user:user,pin:g,board:g.board});b.push(null==h?"":h)}b.push("</div>")}return b.join("")},j._pin_item=function(a){var b=[];with (a || {}){var d;b.push("<div"),b.push(c({"data-id":""+pin.pin_id+"","data-seq":pin.seq?pin.seq:pin.pin_id,"class":"pin wfc"})),b.push("><div"),b.push(c({"class":"actions"})),b.push("><div"),b.push(c({"class":"right"})),b.push(">"),this.req.user&&pin.user_id===this.req.user.user_id?(b.push("<a"),b.push(c({href:"/pins/"+pin.pin_id+"/edit/","class":"edit btn btn11 wbtn"})),b.push("><strong>\u7f16\u8f91</strong><span></span></a>")):pin.liked?(b.push("<a"),b.push(c({"data-id":""+pin.pin_id+"",href:"#",onclick:"return false;","class":"unlike btn btn11 wbtn"})),b.push("><strong><em></em>\u53d6\u6d88\u559c\u6b22</strong><span></span></a>")):(b.push("<a"),b.push(c({"data-id":""+pin.pin_id+"",href:"#",onclick:"return false;","class":"like btn btn11 wbtn"})),b.push("><strong><em></em>\u559c\u6b22</strong><span></span></a>")),b.push("<a"),b.push(c({href:"#",onclick:"return false;","class":"comment clickable btn btn11 wbtn"})),b.push("><strong><em></em>\u8bc4\u8bba</strong><span></span></a></div>"),pin.private||(b.push("<div"),b.push(c({"class":"left"})),b.push("><a"),b.push(c({onclick:"if (app.forceLogin()) app.showDialog('repin', '"+pin.pin_id+"'); return false",href:"#","class":"repin btn btn11 wbtn"})),b.push("><strong><em></em>\u8f6c\u91c7</strong><span></span></a></div>")),b.push("</div><a"),b.push(c({href:"/pins/"+pin.pin_id+"/","class":"img"})),b.push(">");var f=e(pin.file,"fw192");b.push(null==f?"":f),b.push("</a><p"),b.push(c({"class":"description"})),b.push(">");var f=pin.raw_text;b.push(null==f?"":f),b.push("</p><p"),b.push(c({"class":"stats less"})),b.push(">");if(pin.like_count){b.push("<span"),b.push(c({"class":"LikesCount"})),b.push(">");var f=pin.like_count+" \u559c\u6b22&nbsp;&nbsp;";b.push(null==f?"":f),b.push("</span>")}if(pin.comment_count){b.push("<span"),b.push(c({"class":"CommentsCount"})),b.push(">");var f=pin.comment_count+" \u8bc4\u8bba&nbsp;&nbsp;";b.push(null==f?"":f),b.push("</span>")}if(pin.repin_count){b.push("<span"),b.push(c({"class":"RepinsCount"})),b.push(">");var f=pin.repin_count+" \u8f6c\u91c7&nbsp;&nbsp;";b.push(null==f?"":f),b.push("</span>")}b.push("</p><div"),b.push(c({"class":"convo attribution clearfix"})),b.push(">"),this.page.show_pin_source?(b.push("<p"),b.push(c({"class":"NoImage"})),b.push("><a"),b.push(c({href:""+pin.link+"",target:"_blank"})),b.push(">"+i((d=pin.source)==null?"":d)+"</a></p>")):(b.push("<p><a"),b.push(c({href:"/"+i(user.urlname)+"/",title:i(user.username),"class":"img"})),b.push("><img"),b.push(c({src:h(user,undefined)})),b.push("/></a><a"),b.push(c({href:"/"+user.urlname+"/"})),b.push(">"+i((d=user.username)==null?"":d)+"</a>"),pin.via_user&&(b.push("&nbsp;\u901a\u8fc7&nbsp;<a"),b.push(c({href:"/"+pin.via_user.urlname+"/"})),b.push(">"+i((d=pin.via_user.username)==null?"":d)+"</a>")),b.push("&nbsp;\u91c7\u96c6\u5230&nbsp;<a"),b.push(c({href:"/boards/"+pin.board_id+"/"})),b.push(">"+i((d=pin.board.title)==null?"":d)+"</a></p>")),b.push("</div><div"),b.push(c({style:pin.comments?"":"display:none;","class":"comments muted"})),b.push(">");if(pin.comments)for(var g=0,j=pin.comments.length;g<j;g++){var l=pin.comments[g],f=k("_comment_item_convo",l);b.push(null==f?"":f)}b.push("</div>");if(this.req.user){var m=this.req.user;b.push("<div"),b.push(c({style:"display: none;","class":"write convo clearfix"})),b.push("><a"),b.push(c({href:"/"+i(m.urlname)+"/",title:i(m.username),"class":"img"})),b.push("><img"),b.push(c({src:h(m,undefined)})),b.push("/></a><form"),b.push(c({action:"/pins/"+pin.pin_id+"/comment/",method:"POST"})),b.push("><textarea"),b.push(c({placeholder:"\u6dfb\u52a0\u8bc4\u8bba...","class":"GridComment"})),b.push("></textarea><a"),b.push(c({href:"#",onclick:"return false;","class":"grid_comment_button btn btn11 wbtn"})),b.push("><strong>\u6dfb\u52a0</strong><span></span></a></form></div>")}b.push("</div>")}return b.join("")},j._pin_success=function(a){var b=[];with (a || {}){var d,e=app.$pin,f=app.req.user.boards,g;for(var h=0,j=f.length;h<j;h++)if(f[h].board_id==e.board_id){g=f[h];break}b.push("<div"),b.push(c({"class":"form"})),b.push("><div"),b.push(c({"class":"pin-done"})),b.push("><h3>\u4f60\u5df2\u7ecf\u6210\u529f\u91c7\u96c6\u5230\u753b\u677f<a"),b.push(c({href:"/boards/"+g.board_id+"/",target:"_blank","class":"less"})),b.push(">"+i((d=g.title)==null?"":d)+"</a></h3><div"),b.push(c({id:"pin_operations"})),b.push("><a"),b.push(c({id:"view_pin",href:"/pins/"+e.pin_id+"/"})),b.push(">\u67e5\u770b\u8fd9\u4e2a\u91c7\u96c6</a><a"),b.push(c({id:"close_window",href:"#"})),b.push(">\u5173\u95ed\u7a97\u53e3</a></div><ul><li><a"),b.push(c({id:"share_sinaweibo",href:"#",onclick:"return false;","class":"btn btn18 wbtn"})),b.push("><strong>\u5206\u4eab\u5230\u65b0\u6d6a\u5fae\u535a</strong><span></span></a></li><li><a"),b.push(c({id:"share_douban",href:"#",onclick:"return false;","class":"btn btn18 wbtn"})),b.push('><strong>\u5206\u4eab\u5230\u8c46\u74e3</strong><span></span></a></li></ul></div></div><script>(function(){var a=app.$pin,b="http://"+app.page.$url.host+"/pins/"+a.pin_id+"/",c=app.imgURL(a.file,"fw554"),d=a.raw_text,e=$("PinSuccess"),f=window.close;d==""&&(d="\u521a\u521a\u5206\u4eab\u81ea\u82b1\u74e3\u7f51\u7684\u56fe\u7247\uff0c\u6765\u770b\u770b\u5427 "),e&&(f=function(){app.hideDialog()}),$("close_window").addEvent("click",function(){return f(),!1}),Cookie.read("share_to_weibo")=="true"&&$("share_sinaweibo").addClass("disabled"),Cookie.read("share_to_douban")=="true"&&$("share_douban").addClass("disabled"),$$("#share_sinaweibo, #share_douban").addEvent("click",function(){if(this.hasClass("disabled"))return;var a=["url="+encodeURIComponent(b)];if(this.id=="share_sinaweibo"){var e="http://v.t.sina.com.cn/share/share.php?";a.push("&appkey=2499394483"),a.push("&pic="+encodeURIComponent(c)),a.push("&ralateUid=2493118952"),a.push("&title="+encodeURIComponent(d))}else{var e="http://www.douban.com/recommend/?";a.push("&title="+encodeURIComponent(d)),a.push("&comment="+encodeURIComponent(d))}a=a.join(""),function(b,c,d){function g(){window.open([e,a].join(""),"mb",["toolbar=0,status=0,resizable=1,width=620,height=450,left=",(b.width-620)/2,",top=",(b.height-450)/2].join(""))||(u.href=[e,a].join("")),f()}/Firefox/.test(navigator.userAgent)?setTimeout(g,0):g()}(screen,document,encodeURIComponent)}),e||($("view_pin").set("target","_blank").addEvent("click",function(){setTimeout(f,100)}),setTimeout(function(){f()},3e3))})()</script>')}return b.join("")},j._pin_view=function(a){var b=[];with (a || {}){var d;b.push("<div"),b.push(c({"class":"wfx"})),b.push(">");var e=k("_header");b.push(null==e?"":e);var g=page.pin,j=g.board,l="/boards/"+j.board_id,m="/pins/"+g.pin_id,n="/"+g.user.urlname+"/",o=this.req.user&&g.user_id===this.req.user.user_id,p=g.via_user,q=g.via_pin;b.push("<div"),b.push(c({"class":"wfx"})),b.push("><div"),b.push(c({"class":"CloseupLeft"})),b.push(">");var e=k("_board_item",{board:j,user:this.req.user,pin:g});b.push(null==e?"":e);if(g.siblings){b.push("<div"),b.push(c({"class":"Board DomainPins clearfix"})),b.push("><h3>\u540c\u91c7\u81ea<a"),b.push(c({href:"/from/"+g.source+"/","class":"less"})),b.push(">"+i((d=g.source)==null?"":d)+"</a></h3><a"),b.push(c({href:"/from/"+g.source+"/","class":"link"})),b.push(">");for(var r=0,s=g.siblings.length;r<s;r++){var t=g.siblings[r];b.push("<img"),b.push(c({width:"75",height:"75",src:f(t.file,"sq75")})),b.push("/>")}b.push("</a></div>")}b.push("</div><div"),b.push(c({"class":"CloseupRight"})),b.push("><div"),b.push(c({"class":"wt clearfix"})),b.push("><div"),b.push(c({id:"PinPinner"})),b.push("><a"),b.push(c({id:"PinnerImage",href:""+n+"","class":"img"})),b.push("><img"),b.push(c({src:h(g.user,undefined)})),b.push("/></a>");if(p){b.push("<p"),b.push(c({id:"PinnerName"})),b.push("><a"),b.push(c({href:""+n+""})),b.push(">"+i((d=g.user.username)==null?"":d)+"</a><span"),b.push(c({"class":"less"})),b.push(">&nbsp;\u4ece&nbsp;</span><a"),b.push(c({href:"/"+p.urlname+"/"})),b.push(">"+i((d=p.username)==null?"":d)+"</a></p><p"),b.push(c({id:"PinnerStats","class":"less"})),b.push(">\u8f6c\u91c7\u4e8e&nbsp;<span"),b.push(c({"data-ts":""+g.created_at+"","class":"ts-words"})),b.push(">");var e=Date.timeAgo(g.created_at);b.push(null==e?"":e),b.push("</span></p>")}else{b.push("<p"),b.push(c({id:"PinnerName"})),b.push("><a"),b.push(c({href:""+n+""})),b.push(">"+i((d=g.user.username)==null?"":d)+"</a></p><p"),b.push(c({id:"PinnerStats","class":"less"})),b.push(">"),g.via===2?b.push("\u901a\u8fc7\u6d4f\u89c8\u5668\u63d2\u4ef6"):g.via===3?b.push("\u901a\u8fc7\u5206\u4eab\u6309\u94ae"):g.via===4&&(b.push("\u901a\u8fc7<a"),b.push(c({href:"http://www.bshare.cn/",target:"_blank"})),b.push(">\u5206\u4eab\u6309\u94ae</a>")),b.push("\u91c7\u96c6\u4e8e&nbsp;<span"),b.push(c({"data-ts":""+g.created_at+"","class":"ts-words"})),b.push(">");var e=Date.timeAgo(g.created_at);b.push(null==e?"":e),b.push("</span></p>")}b.push("</div><div"),b.push(c({id:"PinActionButtons"})),b.push(">"),g.source&&(b.push("<p"),b.push(c({id:"pin_source","class":"light"})),b.push(">\u91c7\u81ea <a"),b.push(c({href:""+g.link+"",target:"_blank"})),b.push(">"+i((d=g.source)==null?"":d)+"</a></p>")),b.push("<ul>"),g.board.is_private||(b.push("<li"),b.push(c({"class":"repin-button"})),b.push("><a"),b.push(c({onclick:"if (app.forceLogin()) app.showDialog('repin', '"+g.pin_id+"'); return false",href:"#","class":"btn btn13 wbtn"})),b.push("><strong><em></em>\u8f6c\u91c7</strong><span></span></a></li>")),o?(b.push("<li"),b.push(c({"class":"edit-button"})),b.push("><a"),b.push(c({href:""+m+"/edit/","class":"btn wbtn"})),b.push("><strong>\u7f16\u8f91</strong><span></span></a></li>")):g.liked?(b.push("<li"),b.push(c({"class":"like-button"})),b.push("><a"),b.push(c({"data-id":""+g.pin_id+"",title:"\u53d6\u6d88\u559c\u6b22",href:"#",onclick:"return false;","class":"unlike btn wbtn"})),b.push("><strong><em></em>\u53d6\u6d88\u559c\u6b22</strong><span></span></a></li>")):(b.push("<li"),b.push(c({"class":"like-button"})),b.push("><a"),b.push(c({"data-id":""+g.pin_id+"",title:"\u559c\u6b22",href:"#",onclick:"return false;","class":"like btn wbtn"})),b.push("><strong><em></em>\u559c\u6b22</strong><span></span></a></li>")),b.push("</ul></div><div"),b.push(c({id:"pin_img","data-id":""+g.pin_id+"","class":"pin-img"})),b.push(">"),g.link?(b.push("<a"),b.push(c({href:""+g.link+"",target:"_blank"})),b.push("><img"),b.push(c({alt:"\u91c7\u96c6\u56fe\u7247",src:f(g.file,"fw554")})),b.push("/></a>")):(b.push("<img"),b.push(c({alt:"\u91c7\u96c6\u56fe\u7247",src:f(g.file,"fw554")})),b.push("/>")),b.push("</div><div"),b.push(c({id:"pin_caption","class":"pin-caption"})),b.push("><p"),b.push(c({"class":"text"})),b.push(">"+i((d=g.raw_text.nl2br())==null?"":d)+"</p><p"),b.push(c({"class":"via less"})),b.push(">"),q?(b.push("\u8f6c\u91c7\u81ea&nbsp;<a"),b.push(c({href:"/"+p.urlname+"/"})),b.push(">"+i((d=p.username)==null?"":d)+"</a>&nbsp;\u7684&nbsp;<a"),b.push(c({href:"/boards/"+q.board_id+"/"})),b.push(">"+i((d=q.board.title)==null?"":d)+"</a>")):g.via===2?b.push("&nbsp;\u901a\u8fc7\u6d4f\u89c8\u5668\u63d2\u4ef6"):g.via===3?b.push("&nbsp;\u901a\u8fc7\u5206\u4eab\u6309\u94ae"):g.via===4&&(b.push("&nbsp;\u901a\u8fc7<a"),b.push(c({href:"http://www.bshare.cn/",target:"_blank"})),b.push(">\u5206\u4eab\u6309\u94ae</a>")),b.push("</p>");if(q&&g.original!==g.via&&g.original_pin){var u=g.original_pin;b.push("<p"),b.push(c({"class":"origin less"})),b.push(">\u6700\u521d\u7531&nbsp;<a"),b.push(c({href:"/"+u.user.urlname+"/"})),b.push(">"+i((d=u.user.username)==null?"":d)+"</a>&nbsp;\u91c7\u96c6\u5230&nbsp;<a"),b.push(c({href:"/boards/"+u.board_id+"/"})),b.push(">"+i((d=u.board.title)==null?"":d)+"</a></p>")}b.push("</div><div"),b.push(c({id:"pin_comments"})),b.push(">");if(g.comments)for(var r=0,s=g.comments.length;r<s;r++){var v=g.comments[r],e=k("_comment_item",v);b.push(null==e?"":e)}b.push("</div>");if(this.req.user){var e=k("_comment_form",{pin:g,user:this.req.user});b.push(null==e?"":e)}b.push("<div"),b.push(c({id:"pin_likes","class":(!g.likes||g.likes.length===0?"hidden":"")+" "+"PinActivity"+" "+"clearfix"})),b.push("><h4>\u8fd9\u4e9b\u4eba\u559c\u6b22</h4>");var w=g.likes||[],x=g.like_count-w.length;for(var r=0,s=w.length;r<s;r++){var y=w[r];b.push("<a"),b.push(c({href:"/"+y.urlname+"/",title:""+y.username+"","class":"avatar"})),b.push("><img"),b.push(c({src:h(y,undefined)})),b.push("/></a>")}x>0&&(b.push("<p"),b.push(c({"class":"PinMoreActivity"})),b.push(">"+i((d=x)==null?"":d)+"\u66f4\u591a\u559c\u6b22\u7684\u4eba</p>")),b.push("</div><div"),b.push(c({id:"PinRepins","class":(!g.repins||g.repins.length===0?"hidden":"")+" "+"PinActivity"+" "+"clearfix"})),b.push("><h4>\u88ab\u8fd9\u4e9b\u4eba\u8f6c\u91c7</h4>");var z=g.repins||[],x=g.repins_count-z.length;for(var r=0,s=z.length;r<s;r++){var A=z[r];b.push("<div"),b.push(c({"class":"PinRepinStory"})),b.push("><a"),b.push(c({href:"/"+A.user.urlname+"/","class":"avatar"})),b.push("><img"),b.push(c({src:h(A.user,undefined)})),b.push("/></a><span"),b.push(c({"class":"repin_post_attr"})),b.push("><a"),b.push(c({href:"/"+A.user.urlname+"/"})),b.push(">"+i((d=A.user.username)==null?"":d)+"</a>\u91c7\u96c6\u5230<a"),b.push(c({href:"/boards/"+A.board_id+"/"})),b.push(">"+i((d=A.board.title)==null?"":d)+"</a></span></div>")}x>0&&(b.push("<p"),b.push(c({"class":"PinMoreActivity"})),b.push(">"+i((d=x)==null?"":d)+"\u66f4\u591a\u8f6c\u91c7</p>")),b.push("</div><div"),b.push(c({id:"pin_tool_bar"})),b.push("><ul><li><div"),b.push(c({"class":"PriorAndNext"})),b.push(">");var B=g.next?"":"disabled",C=g.prev?"":"disabled";g.next?(b.push("<a"),b.push(c({href:"/pins/"+g.next.pin_id+"/",title:"\u4e0a\u4e00\u5f20","class":"prev "+B+""})),b.push("></a>")):(b.push("<a"),b.push(c({title:"\u4e0a\u4e00\u5f20","class":"prev "+B+""})),b.push("></a>")),g.prev?(b.push("<a"),b.push(c({href:"/pins/"+g.prev.pin_id+"/",title:"\u4e0b\u4e00\u5f20","class":"next "+C+""})),b.push("></a>")):(b.push("<a"),b.push(c({title:"\u4e0b\u4e00\u5f20","class":"next "+C+""})),b.push("></a>")),b.push("</div></li><li"),b.push(c({"class":"share-text"})),b.push(">\u5206\u4eab\u5230</li><li"),b.push(c({id:"share_to_weibo","class":"share-btn"})),b.push("><span>\u5fae\u535a</span></li><li"),b.push(c({id:"share_to_douban","class":"share-btn"})),b.push('><span>\u8c46\u74e3</span></li></ul><script>(function(){var a=$("pin_img"),b="http://"+app.page.$url.host+"/pins/"+a.get("data-id")+"/",c=a.getElement("img").get("src"),d=$("pin_caption").getElement("p.text").get("html");$$(".share-btn").addEvent("click",function(){var a=["url="+encodeURIComponent(b)];if(this.id=="share_to_weibo"){var e="http://v.t.sina.com.cn/share/share.php?";a.push("&appkey=2499394483"),a.push("&pic="+encodeURIComponent(c)),a.push("&ralateUid=2493118952"),a.push("&title="+encodeURIComponent(d))}else if(this.id=="share_to_douban"){var e="http://www.douban.com/recommend/?";a.push("&title="+encodeURIComponent(d)),a.push("&comment="+encodeURIComponent(d))}a=a.join(""),function(b,c,d){function g(){window.open([e,a].join(""),"mb",["toolbar=0,status=0,resizable=1,width=620,height=450,left=",(b.width-620)/2,",top=",(b.height-450)/2].join(""))||(u.href=[e,a].join(""))}/Firefox/.test(navigator.userAgent)?setTimeout(g,0):g()}(screen,document,encodeURIComponent)});try{document.body.getElements(".pin-img a").addEvent("click",function(){var a=new Image;return a.src="http://huaban.com/pins/clicks?pin_id="+app.page.pin.pin_id+"&link="+encodeURIComponent(app.page.pin.link)+"&t="+(new Date).getTime(),!0})}catch(e){}})()</script></div></div></div></div></div><script>app.initFollowButtons(),app.initLikeButtons(),app.initDelCommentButtons(),app.initAddCommentButtons()</script>')}return b.join("")},j._pointy_tip=function(a){var b=[];with (a || {}){var d;b.push("<div"),b.push(c({id:""+id+"","class":"pointy-tip"})),b.push("><div"),b.push(c({"class":"pointy-tip-body"})),b.push("><span"),b.push(c({"class":"arrow"})),b.push(">\u25e3</span><span"),b.push(c({"class":"arrow-mask"})),b.push("></span><a"),b.push(c({href:"javascript:void(0);","class":"close"})),b.push("></a>");if(title){b.push("<h5"),b.push(c({"class":"title"})),b.push(">");var e=title;b.push(null==e?"":e),b.push("</h5>")}if(content){b.push("<div"),b.push(c({"class":"content"})),b.push(">");var e=content;b.push(null==e?"":e),b.push("</div>")}b.push("</div></div>")}return b.join("")},j._search_result=function(a){var b=[];with (a || {}){var d,e=k("_header");b.push(null==e?"":e),b.push("<div"),b.push(c({"class":"wrapper"})),b.push("><div"),b.push(c({id:"ctx_bar","class":"board"})),b.push("><p>");var f=page.query,g=i(f.text),h=[],j=[[page.pin_count,"pin","\u91c7\u96c6","/"],[page.board_count,"board","\u753b\u677f","/boards/"],[page.people_count,"people","\u7528\u6237","/people/"]];for(var l=0,m=j.length;l<m;l++){var n=j[l];if(f.type==n[1]){b.push("<span"),b.push(c({"class":"selected"})),b.push(">");var e=n[0]+" "+n[2];b.push(null==e?"":e),b.push("</span>")}else{b.push("<a"),b.push(c({href:"/search"+n[3]+"?q="+g})),b.push(">");var e=n[0]+" "+n[2];b.push(null==e?"":e),b.push("</a>")}l!==j.length-1&&b.push("&nbsp;\u00b7&nbsp;")}b.push("<span"),b.push(c({"class":"greyselected"})),b.push(">\u2014 \u641c\u7d22\u7ed3\u679c: <span"),b.push(c({"class":"hilight"})),b.push(">"+i((d=g)==null?"":d)+"<span></span></span></span></p></div><div"),b.push(c({id:"waterfall"})),b.push(">");if(f.type=="pin")for(var o=0,m=page.pins.length;o<m;o++){var p=page.pins[o],e=k("_pin_item",{user:p.user,pin:p,board:p.board});b.push(null==e?"":e)}else if(f.type=="board")for(var o=0,m=page.boards.length;o<m;o++){var q=page.boards[o],e=k("_board_item",{board:q,user:req.user});b.push(null==e?"":e)}else if(f.type=="people")for(var o=0,m=page.users.length;o<m;o++){var r=page.users[o],e=k("_user_item",{user:r,current_user:this.req.user});b.push(null==e?"":e)}b.push("</div></div><script>(function(){app.initLikeButtons(),app.initAddCommentButtons(),app.initFollowButtons(),app.initFollowUserButtons()})()</script>")}return b.join("")},j._unauth_callout=function(a){var b=[];with (a || {}){var d;b.push("<div"),b.push(c({id:"unauth_callout"})),b.push("><div"),b.push(c({"class":"wrapper"})),b.push("><div"),b.push(c({id:"intro"})),b.push("><h2>\u82b1\u74e3\uff0c\u91c7\u96c6\u4f60\u559c\u6b22\u7684\u3002</h2><div><a"),b.push(c({href:"/landing/","class":"btn btn18 rbtn"})),b.push("><strong> \u7533\u8bf7\u9080\u8bf7\u7801 \u00bb</strong><span></span></a><a"),b.push(c({href:"/login/","class":"btn btn18 wbtn"})),b.push("><strong> \u767b\u5f55</strong><span></span></a></div>"),page.$url.pathname.indexOf("/pins/")!==0&&(b.push("<a"),b.push(c({id:"mv_trigger",href:"#",onclick:"app.showDialog('mv');return false;",title:"\u89c2\u770b\u89c6\u9891\uff0c\u4e86\u89e3\u82b1\u74e3","class":"mv"})),b.push("></a>")),b.push("</div></div></div>")}return b.join("")},j._user_item=function(a){var b=[];with (a || {}){var d;b.push("<div"),b.push(c({"data-id":""+user.user_id+"","data-seq":""+user.user_id+"","class":"pin user wfc"})),b.push("><a"),b.push(c({href:"/"+i(user.urlname)+"/",title:i(user.username),"class":"img"})),b.push("><img"),b.push(c({src:h(user,"fw192")})),b.push("/></a><h2>"+i((d=user.username)==null?"":d)+"</h2><p"),b.push(c({"class":"location less"})),b.push("></p>"),current_user&&(current_user.user_id!==user.user_id?user.following?(b.push("<a"),b.push(c({href:"/"+user.urlname+"/unfollow/","data-id":user.urlname,"class":"unfollowuser btn btn13 wbtn"})),b.push("><strong> \u53d6\u6d88\u5173\u6ce8</strong><span></span></a>")):(b.push("<a"),b.push(c({href:"/"+user.urlname+"/unfollow/","data-id":user.urlname,"class":"followuser btn btn13 wbtn"})),b.push("><strong> \u5173\u6ce8</strong><span></span></a>")):(b.push("<a"),b.push(c({href:"/settings/","class":"btn btn13 wbtn"})),b.push("><strong> \u5e10\u53f7\u8bbe\u7f6e</strong><span></span></a>"))),b.push("</div>")}return b.join("")}})(app)